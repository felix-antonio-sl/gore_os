_meta:
  urn: urn:goreos:entity:d_tde:ENT-TDE-DESTINATARIO_NOTIFICACION:1.0.0
  type: Entity
  schema: urn:goreos:schema:entity:1.0.0
category: Master
is_abstract: false
attributes:
- name: id_destinatario
  type: String
  key: true
- name: notificacion_id
  type: String
  fk: ENT-TDE-NOTIFICACION-ELECTRONICA
  nullable: false
- name: rol_unico
  type: String
  nullable: false
  description: RUN o RUT sin dígito verificador
- name: tipo_ddu
  type: Enum[casilla, email, not_configured, excepcion]
  nullable: false
  description: Tipo de Domicilio Digital del destinatario
- name: estado_mensaje
  type: Enum[pending, delivered, error, error_rejected, error_undetermined_undetermined,
    error_permanent_general, error_permanent_no_email, error_permanent_supressed,
    error_permanent_on_account_suspension_list, error_transient_general, error_transient_mailbox_full,
    error_transient_message_too_large, error_transient_content_rejected, error_transient_attachment_rejected,
    error_send_message_mail]
  default: pending
  description: Estado detallado de entrega según API
- name: metodo_entrega
  type: String
  nullable: true
  description: Método usado para la entrega (casilla, email)
- name: fecha_entrega
  type: Timestamp
  nullable: true
  description: Fecha en que se entregó el mensaje
- name: fecha_lectura
  type: Timestamp
  nullable: true
  description: Fecha en que el destinatario leyó el mensaje
- name: entregado
  type: Boolean
  computed: true
  formula: estado_mensaje = 'delivered'
- name: leido
  type: Boolean
  computed: true
  formula: fecha_lectura IS NOT NULL
invariants:
- id: INV-DEST-001
  name: rol_unico_valido
  rule: rol_unico MATCHES '^[0-9]+$'
  description: RUN/RUT debe ser numérico sin DV
- id: INV-DEST-002
  name: lectura_requiere_entrega
  rule: fecha_lectura IS NOT NULL → fecha_entrega IS NOT NULL
  description: No puede marcarse como leído sin estar entregado
id: ENT-TDE-DESTINATARIO_NOTIFICACION
urn: urn:goreos:entity:d_tde:ENT-TDE-DESTINATARIO_NOTIFICACION:1.0.0
name: Destinatario Notificacion
domain: D-TDE
