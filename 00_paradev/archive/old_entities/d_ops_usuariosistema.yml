_meta:
  urn: urn:goreos:entity:d_ops:ENT-OPS-USUARIOSISTEMA:1.0.0
  type: Entity
  schema: urn:goreos:schema:entity:1.0.0
category: Master
is_abstract: false
attributes:
- name: id_usuario
  type: String
  key: true
- name: email
  type: String
  nullable: false
- name: nombre_completo
  type: String
  nullable: false
- name: rut
  type: String
  nullable: true
  description: RUT para integración ClaveÚnica
- name: tipo
  type: Enum[Funcionario, Externo, Servicio, Sistema]
  nullable: false
- name: funcionario_id
  type: String
  fk: ENT-BACK-FUNCIONARIO
  nullable: true
  description: Vinculación con funcionario si aplica
- name: estado
  type: Enum[Pendiente, Activo, Suspendido, Inactivo]
  default: Pendiente
- name: metodo_autenticacion
  type: Enum[Password, ClaveUnica, SSO, APIKey]
  default: ClaveUnica
- name: ultimo_acceso
  type: DateTime
  nullable: true
- name: intentos_fallidos
  type: Integer
  default: 0
- name: bloqueado_hasta
  type: DateTime
  nullable: true
- name: fecha_creacion
  type: Date
  nullable: false
- name: fecha_expiracion
  type: Date
  nullable: true
  description: Para usuarios temporales
invariants:
- id: INV-USR-001
  name: email_unico
  rule: UNIQUE(email)
  description: Email debe ser único en el sistema
- id: INV-USR-002
  name: activo_tiene_rol
  rule: estado = 'Activo' → roles.count > 0
  description: Usuario activo debe tener al menos un rol
- id: INV-USR-003
  name: bloqueo_por_intentos
  rule: intentos_fallidos >= 5 → bloqueado_hasta IS NOT NULL
  description: 5 intentos fallidos bloquean la cuenta
id: ENT-OPS-USUARIOSISTEMA
urn: urn:goreos:entity:d_ops:ENT-OPS-USUARIOSISTEMA:1.0.0
name: Usuariosistema
domain: D-OPS
