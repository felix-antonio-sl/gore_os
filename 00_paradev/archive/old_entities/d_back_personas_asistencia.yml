_meta:
  urn: urn:goreos:entity:d_back:ENT-BACK-PERSONAS_ASISTENCIA:1.0.0
  type: Entity
  schema: urn:goreos:schema:entity:1.0.0
category: Master
is_abstract: false
attributes:
- name: id_registro
  type: String
  key: true
- name: funcionario_id
  type: String
  fk: ENT-BACK-FUNCIONARIO
  nullable: false
- name: fecha
  type: Date
  nullable: false
- name: hora_entrada_esperada
  type: Time
  nullable: false
  description: Hora de entrada según jornada asignada
- name: hora_salida_esperada
  type: Time
  nullable: false
  description: Hora de salida según jornada asignada
- name: hora_entrada_real
  type: Time
  nullable: true
  description: Hora efectiva de marcación de entrada
- name: hora_salida_real
  type: Time
  nullable: true
  description: Hora efectiva de marcación de salida
- name: metodo_marcacion
  type: Enum[Biometrico, Tarjeta, Manual, Teletrabajo]
  nullable: true
- name: minutos_atraso
  type: Integer
  computed: true
  default: 0
  description: Minutos de atraso en entrada
- name: minutos_tiempo_menor
  type: Integer
  computed: true
  default: 0
  description: Minutos de salida anticipada o jornada incompleta
- name: horas_trabajadas
  type: Decimal
  computed: true
  description: Total de horas trabajadas en el día
- name: tiene_colacion
  type: Boolean
  default: true
  description: Si aplica tiempo de colación
- name: minutos_colacion
  type: Integer
  default: 60
- name: atraso_justificado
  type: Boolean
  default: false
- name: justificacion_atraso
  type: Text
  nullable: true
- name: justificado_por_id
  type: String
  fk: ENT-BACK-FUNCIONARIO
  nullable: true
  description: Jefatura que justifica el atraso
- name: fecha_justificacion
  type: Date
  nullable: true
- name: tipo_dia
  type: Enum[Laboral, Feriado, FinDeSemana, Licencia, Permiso, Cometido, Teletrabajo,
    Feriado_Legal]
  default: Laboral
- name: estado
  type: Enum[Pendiente, Marcado, Justificado, ParaDescuento, Procesado]
  default: Pendiente
- name: aplica_descuento
  type: Boolean
  computed: true
  description: True si atraso + tiempo_menor > 59 min en el mes sin justificar
- name: permiso_asociado_id
  type: String
  fk: ENT-BACK-PERMISO
  nullable: true
  description: Referencia a permiso si el día es de licencia/permiso
- name: cometido_asociado_id
  type: String
  fk: ENT-BACK-COMETIDO
  nullable: true
  description: Referencia a cometido si el día es de cometido
invariants:
- id: INV-ASIS-001
  name: salida_posterior_entrada
  rule: hora_salida_real > hora_entrada_real
  description: Salida debe ser posterior a entrada
- id: INV-ASIS-002
  name: descuento_umbral_mensual
  rule: "aplica_descuento = true ↔ \nSUM(minutos_atraso + minutos_tiempo_menor WHERE\
    \ mes AND NOT justificado) > 59\n"
  description: Descuento solo si supera 59 minutos mensuales
- id: INV-ASIS-003
  name: justificacion_dentro_plazo
  rule: fecha_justificacion <= fecha + 5 días hábiles
  description: Justificación debe hacerse dentro de 5 días hábiles
id: ENT-BACK-PERSONAS_ASISTENCIA
urn: urn:goreos:entity:d_back:ENT-BACK-PERSONAS_ASISTENCIA:1.0.0
name: Personas Asistencia
domain: D-BACK
