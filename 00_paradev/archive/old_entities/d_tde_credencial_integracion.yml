_meta:
  urn: urn:goreos:entity:d_tde:ENT-TDE-CREDENCIAL_INTEGRACION:1.0.0
  type: Entity
  schema: urn:goreos:schema:entity:1.0.0
category: Master
is_abstract: false
attributes:
- name: id_credencial
  type: String
  key: true
- name: plataforma_id
  type: String
  fk: ENT-TDE-PLATAFORMA
  nullable: false
  description: ClaveÚnica, PISEE, Notificaciones, etc.
- name: entidad_usuaria_id
  type: String
  fk: ENT-TDE-ENTIDAD-REGIONAL
  nullable: false
- name: ambiente
  type: Enum[Sandbox, QA, Produccion]
  nullable: false
- name: client_id
  type: String
  nullable: false
  description: Identificador único de la integración
- name: client_secret_hash
  type: String
  nullable: false
  description: Hash del secret (NUNCA almacenar en plano)
- name: redirect_uris
  type: Array[String]
  nullable: false
  description: Endpoints de callback autorizados
- name: logout_uris
  type: Array[String]
  nullable: true
  description: URIs de cierre de sesión registradas
- name: nombre_aplicacion
  type: String
  nullable: false
  description: Texto mostrado en formulario de login
- name: descripcion_aplicacion
  type: Text
  nullable: true
- name: url_aplicacion
  type: String
  nullable: true
  description: URL pública del sitio (dominio .gob.cl en prod)
- name: tipo_publico
  type: Enum[Publico, Interno]
  default: Publico
  description: Ciudadanía vs. funcionarios
- name: contacto_admin_email
  type: String
  nullable: false
  description: Email institucional nominativo
- name: contacto_tecnico_email
  type: String
  nullable: false
- name: fecha_emision
  type: Date
  nullable: false
- name: fecha_certificacion
  type: Date
  nullable: true
  description: Fecha de certificación para producción
- name: estado
  type: Enum[Activa, Revocada, Suspendida, Pendiente_Certificacion]
  default: Pendiente_Certificacion
invariants:
- id: INV-CRED-001
  name: produccion_requiere_certificacion
  rule: ambiente = 'Produccion' AND estado = 'Activa' → fecha_certificacion IS NOT
    NULL
  description: Credenciales productivas requieren certificación
- id: INV-CRED-002
  name: email_institucional
  rule: contacto_admin_email CONTAINS '.gob.cl' OR contacto_admin_email CONTAINS '.gov.cl'
  description: Contacto admin debe ser institucional
- id: INV-CRED-003
  name: redirect_uri_no_localhost_prod
  rule: ambiente = 'Produccion' → NOT ANY(uri IN redirect_uris WHERE uri CONTAINS
    'localhost')
  description: No se permite localhost en producción
id: ENT-TDE-CREDENCIAL_INTEGRACION
urn: urn:goreos:entity:d_tde:ENT-TDE-CREDENCIAL_INTEGRACION:1.0.0
name: Credencial Integracion
domain: D-TDE
