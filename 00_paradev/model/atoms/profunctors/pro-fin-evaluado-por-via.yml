---
# Profunctor: Evaluado Por Vía
# Relaciona IPR con su Vía de Evaluación
_meta:
  urn: urn:goreos:profunctor:fiscus:evaluado-por-via:1.0.0
  type: Profunctor
  schema: urn:goreos:schema:profunctor:1.0.0
  source: "Taxonomía Categorial IPR"

id: PRO-FIN-EVALUADO-POR-VIA
name: evaluado_por_via
description: >-
  Morfismo que relaciona una IPR con su Vía de Evaluación (mecanismo procesal).
  Categoría VIA_EVALUACION es distinta de FONDO.

domain: ENT-FIN-IPR
codomain: ENT-FIN-VIA-EVALUACION

cardinality: N:1
nullable: false

semantics:
  verb: "se evalúa por"
  inverse_verb: "evalúa a"
  question: "¿Por qué vía procesal se tramita esta IPR?"

# === Restricciones de Exclusividad ===
invariants:
  - id: VIA-MUTUAMENTE-EXCLUYENTE
    description: "Una IPR sigue UNA y SOLO UNA vía de evaluación"
    expression: "∀ ipr: |via_evaluacion| = 1"

  - id: VIA-COHERENCIA-TIPO
    description: "IDI usa vías IDI, PPR usa vías PPR"
    expression: |
      ∀ ipr:
        ipr.tipo = 'IDI' → via.aplica_a ∈ {'IDI', 'AMBOS'}
        ipr.tipo = 'PPR' → via.aplica_a ∈ {'PPR', 'AMBOS'}

  - id: VIA-COHERENCIA-EVALUADOR
    description: "El evaluador depende de la vía"
    expression: |
      via.codigo = 'SNI_GENERAL' → evaluador = 'MDSF'
      via.codigo ∈ {'FRIL_VIA', 'CIRCULAR_33', 'SUBVENCION_8', 'TRANSFERENCIA_PUBLICO'} → evaluador = 'GORE'
      via.codigo = 'GLOSA_06_DIRECTA' → evaluador = 'DIPRES/SES'
