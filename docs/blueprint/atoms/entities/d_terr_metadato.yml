# ==============================================================================
# GORE_OS Entity Atom: Metadato (ISO 19115-1 / LAMPv2)
# ==============================================================================
# Domain: D-TERR (Territorial Intelligence)
# Subdomain: IDE
# Source: KB-090, ISO 19115-1, Perfil LAMPv2, dialogo_dplan_dterr.md
# ==============================================================================

_metadata:
  version: "1.0.0"
  status: active
  created_at: "2025-12-21"
  created_by: "Arquitecto Categórico + Gobernador Virtual"
  domain: D-TERR
  subdomain: ide
  kb_source:
    - "kb_gn_090_gestion_informacion_geoespacial_koda.yml §225-247"
    - "ISO 19115-1"
    - "Perfil LAMPv2"

entity:
  id: ENT-TERR-METADATO
  name: Metadato
  name_es: Metadato Geoespacial
  description: |
    Conjunto estructurado de descriptores de un recurso geoespacial
    conforme a ISO 19115-1. Incluye identificación, calidad, distribución
    y responsabilidad siguiendo el Perfil LAMPv2 / Perfil Chileno.

    Publicado vía CSW (Catalog Service for the Web) para federación
    con IDE Chile.

  purpose: |
    Modelar metadatos para:
    - Cumplimiento ISO 19115-1
    - Federación con IDE Chile vía CSW
    - Descubrimiento y búsqueda
    - Trazabilidad y calidad

  categorical_type: Object
  is_abstract: false
  category: Transactional

attributes:
  - name: id_metadato
    type: String
    key: true
    description: Identificador único del metadato

  - name: capa_id
    type: String
    fk: ENT-TERR-CAPA
    nullable: false
    description: Capa que describe

  # IDENTIFICACIÓN (KB-090 §240-246)
  - name: titulo
    type: String
    nullable: false
    description: Título del recurso

  - name: resumen
    type: Text
    nullable: false
    description: Resumen descriptivo

  - name: palabras_clave
    type: Array[String]
    nullable: false
    description: Palabras clave para búsqueda

  - name: tematica
    type: String
    nullable: false
    description: Categoría temática ISO

  - name: alcance_espacial
    type: Geometry
    nullable: true
    description: Extensión geográfica

  - name: alcance_temporal_inicio
    type: Date
    nullable: true
    description: Inicio período temporal

  - name: alcance_temporal_fin
    type: Date
    nullable: true
    description: Fin período temporal

  # CALIDAD (ISO 19157, KB-090 §248-257)
  - name: linaje
    type: Text
    nullable: true
    description: Procedencia y procesamiento

  - name: precision_posicional
    type: Decimal
    nullable: true
    description: Precisión posicional en metros

  - name: precision_temporal
    type: String
    nullable: true
    description: Precisión temporal

  - name: completitud
    type: Decimal
    nullable: true
    description: Porcentaje de completitud

  - name: consistencia_logica
    type: Boolean
    nullable: true
    description: ¿Pasa validación lógica?

  # DISTRIBUCIÓN
  - name: formatos
    type: Array[Enum[GeoJSON, GML, KML, Shapefile, GeoTIFF, CSV]]
    nullable: true
    description: Formatos disponibles

  - name: url_descarga
    type: String
    nullable: true
    description: URL de descarga

  - name: url_servicio
    type: String
    nullable: true
    description: URL de servicio OGC

  - name: terminos_uso
    type: Text
    nullable: true
    description: Términos de uso y restricciones

  - name: licencia
    type: String
    nullable: true
    description: Código de licencia

  # RESPONSABILIDAD
  - name: responsable
    type: String
    nullable: false
    description: Organización responsable

  - name: rol_responsable
    type: Enum[Propietario, Custodio, Distribuidor, Autor]
    default: Propietario
    description: Rol según ISO

  - name: contacto_nombre
    type: String
    nullable: true
    description: Nombre de contacto

  - name: contacto_email
    type: String
    nullable: false
    description: Email de contacto

  - name: contacto_telefono
    type: String
    nullable: true
    description: Teléfono de contacto

  # FECHAS
  - name: fecha_creacion
    type: Date
    nullable: false
    description: Fecha de creación del metadato

  - name: fecha_publicacion
    type: Date
    nullable: true
    description: Fecha de publicación

  - name: fecha_revision
    type: Date
    nullable: true
    description: Última revisión

  - name: frecuencia_mantenimiento
    type: Enum[Continuo, Diario, Semanal, Mensual, Anual, Irregular]
    default: Irregular
    description: Frecuencia de mantenimiento

  # Estado
  - name: estado
    type: Enum[Borrador, Validado, Publicado, Obsoleto]
    default: Borrador
    description: Estado del metadato

invariants:
  - id: INV-META-001
    name: campos_minimos_lamp
    rule: |
      titulo IS NOT NULL AND resumen IS NOT NULL AND 
      palabras_clave IS NOT NULL AND contacto_email IS NOT NULL
    description: Campos mínimos LAMPv2
    severity: error

  - id: INV-META-002
    name: publicado_requiere_validacion
    rule: |
      (estado = 'Publicado') → (consistencia_logica = true OR consistencia_logica IS NULL)
    description: Metadato publicado debe pasar validación

morphisms:
  describe: [ENT-TERR-CAPA]
  publicado_via: [CSW]
  federado_con: [IDE_Chile]

audit:
  fields_tracked:
    - estado
    - fecha_revision
  retention_years: 10
