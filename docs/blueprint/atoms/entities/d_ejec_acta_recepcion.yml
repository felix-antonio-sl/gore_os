# Entidad: ActaRecepcion
# Domain: D-EJEC
# Generated: 2025-12-21 (Phase 20.2)

id: ENT-EJEC-ACTA_RECEPCION
urn: "urn:goreos:entity:d-ejec:acta-recepcion:1.0.0"
name: Acta de Recepción
domain: D-EJEC
category: Legal
canonical_source:
  - "domain_d-ejec.md#p4-cierre-y-liquidación"
  - "Ley 19.886, D.S. 75 MOP"

description: |
  Documento formal que certifica la recepción de obras o servicios.
  Puede ser provisional (con observaciones) o definitiva.
  Habilita liberación de garantías y cierre de convenio.

attributes:
  - name: id_acta
    type: String
    key: true

  - name: convenio_id
    type: String
    fk: ENT-FIN-CONVENIO
    nullable: false

  - name: numero_acta
    type: String
    nullable: false

  # Tipo
  - name: tipo_recepcion
    type: Enum[Provisoria, Definitiva, Parcial]
    nullable: false

  # Fechas
  - name: fecha_acta
    type: Date
    nullable: false

  - name: fecha_inspeccion_final
    type: Date
    nullable: true

  # Conformidad
  - name: conformidad
    type: Enum[Conforme, ConformeConObservaciones, NoConforme]
    nullable: false

  - name: observaciones
    type: Text
    nullable: true

  - name: plazo_subsanacion_dias
    type: Integer
    nullable: true
    description: Días para corregir observaciones

  - name: fecha_limite_subsanacion
    type: Date
    nullable: true

  # Firmantes
  - name: resolucion_comision
    type: String
    nullable: true
    description: Número de resolución que designa la Comisión de Recepción (Phase 20.2 Enrichment)

  - name: firmantes
    type: List[YAML]
    nullable: false
    description: Lista de {nombre, cargo, institucion, firma_electronica}

  - name: representante_gore
    type: String
    nullable: false

  - name: representante_ejecutor
    type: String
    nullable: false

  # Obras/Bienes recibidos
  - name: descripcion_recibido
    type: Text
    nullable: false

  - name: monto_obra_recibida
    type: Decimal
    nullable: true

  - name: superficie_m2
    type: Decimal
    nullable: true

  # Garantías
  - name: libera_garantia_fiel_cumplimiento
    type: Boolean
    default: false

  - name: garantia_correcta_ejecucion_id
    type: String
    fk: ENT-FIN-GARANTIA
    nullable: true
    description: Nueva garantía por período de responsabilidad

  - name: periodo_responsabilidad_meses
    type: Integer
    default: 12

  # Estado
  - name: estado
    type: Enum[Borrador, EnFirma, Firmada, Observada, Anulada]
    default: Borrador

  # Documento
  - name: documento_url
    type: String
    nullable: true

  - name: resolucion_aprobacion
    type: String
    nullable: true

invariants:
  - name: definitiva_sin_observaciones
    rule: "IF tipo_recepcion = Definitiva THEN conformidad = Conforme"

  - name: provisoria_plazo
    rule: "IF conformidad = ConformeConObservaciones THEN plazo_subsanacion_dias NOT NULL"

morphisms:
  cierra: [ENT-FIN-CONVENIO]
  libera: [ENT-FIN-GARANTIA]
  firmada_por: [GORE, Ejecutor]
  genera: [ResolucionLiquidacion]
