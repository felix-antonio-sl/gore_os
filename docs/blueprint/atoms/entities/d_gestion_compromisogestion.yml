# ==============================================================================
# GORE_OS Entity Atom: CompromisoGestion (Compromiso de Gestión)
# ==============================================================================
# Domain: D-GESTION (Control de Gestión y Operación)
# Subdomain: Gobernanza Operativa
# Source: Gap analysis dialogo_riguroso_d_gestion.md
# ==============================================================================

_metadata:
  version: "1.0.0"
  status: active
  created_at: "2025-12-22"
  created_by: "Arquitecto Categórico + AR Virtual"
  domain: D-GESTION
  subdomain: gobernanza_operativa
  kb_source:
    - "Operación real GORE: acuerdos y tareas de reuniones"
    - "kb_gn_035 → Gestion_Estrategica_GORE"

entity:
  id: ENT-GESTION-COMPROMISO
  name: CompromisoGestion
  name_es: Compromiso de Gestión
  description: |
    Representa una tarea, acuerdo o decisión emanada de una
    InstanciaGestion (reunión formal).

    Cada compromiso tiene:
    - Responsable asignado
    - Fecha límite
    - Estado de cumplimiento
    - Verificación de cierre

    Los compromisos alimentan el ciclo PDCA de mejora continua.

  purpose: |
    Modelar compromisos para:
    - Trazar acuerdos de reuniones
    - Asignar responsabilidades con plazos
    - Monitorear cumplimiento
    - Escalar incumplimientos

  categorical_type: Object
  is_abstract: false
  category: Transactional

attributes:
  - name: id_compromiso
    type: String
    key: true
    description: "Identificador único (ej: CG-2025-001)"

  - name: instancia_id
    type: String
    fk: ENT-GESTION-INSTANCIA
    nullable: false
    description: Instancia de origen

  - name: numero_punto
    type: Integer
    nullable: true
    description: Punto de tabla origen

  # Descripción
  - name: descripcion
    type: Text
    nullable: false
    description: Descripción del compromiso

  - name: resultado_esperado
    type: Text
    nullable: true
    description: Entregable o resultado esperado

  # Clasificación
  - name: tipo
    type: Enum[Tarea, Decision, Acuerdo, Instruccion, Seguimiento]
    default: Tarea
    description: Tipo de compromiso

  - name: prioridad
    type: Enum[Urgente, Alta, Media, Baja]
    default: Media
    description: Prioridad asignada

  # Responsabilidad
  - name: responsable_id
    type: String
    fk: ENT-BACK-FUNCIONARIO
    nullable: false
    description: Responsable del cumplimiento

  - name: corresponsables
    type: Array[String]
    nullable: true
    description: IDs de corresponsables si aplica

  - name: supervisor_id
    type: String
    fk: ENT-BACK-FUNCIONARIO
    nullable: true
    description: Quien supervisa cumplimiento (usualmente AR)

  # Temporalidad
  - name: fecha_asignacion
    type: Date
    nullable: false
    description: Fecha de asignación

  - name: fecha_limite
    type: Date
    nullable: false
    description: Fecha límite de cumplimiento

  - name: fecha_cumplimiento
    type: Date
    nullable: true
    description: Fecha real de cumplimiento

  - name: dias_atraso
    type: Integer
    computed: true
    formula: |
      CASE 
        WHEN fecha_cumplimiento IS NOT NULL 
        THEN GREATEST(0, DATEDIFF(fecha_cumplimiento, fecha_limite))
        WHEN CURRENT_DATE > fecha_limite 
        THEN DATEDIFF(CURRENT_DATE, fecha_limite)
        ELSE 0
      END
    description: Días de atraso si aplica

  # Estado
  - name: estado
    type: Enum[Pendiente, EnProgreso, Cumplido, CumplidoParcial, NoCumplido, Cancelado, Prorrogado]
    default: Pendiente
    description: Estado del compromiso

  - name: porcentaje_avance
    type: Integer
    default: 0
    description: Porcentaje de avance (0-100)

  # Verificación
  - name: evidencia_cumplimiento
    type: Text
    nullable: true
    description: Descripción de evidencia presentada

  - name: url_evidencia
    type: String
    nullable: true
    description: URL a documento de evidencia

  - name: verificador_id
    type: String
    fk: ENT-BACK-FUNCIONARIO
    nullable: true
    description: Quien verificó el cumplimiento

  - name: fecha_verificacion
    type: Date
    nullable: true
    description: Fecha de verificación

  # Prórroga
  - name: prorroga_solicitada
    type: Boolean
    default: false
    description: ¿Se solicitó prórroga?

  - name: nueva_fecha_limite
    type: Date
    nullable: true
    description: Nueva fecha si hay prórroga

  - name: motivo_prorroga
    type: Text
    nullable: true
    description: Justificación de la prórroga

  # Observaciones
  - name: observaciones
    type: Text
    nullable: true
    description: Notas adicionales

  # Vinculación
  - name: oportunidad_mejora_id
    type: String
    fk: ENT-GESTION-OPORTUNIDAD-MEJORA
    nullable: true
    description: Oportunidad de mejora generada si aplica

invariants:
  - id: INV-CG-001
    name: cumplido_requiere_fecha
    rule: estado = 'Cumplido' → fecha_cumplimiento IS NOT NULL
    description: Compromiso cumplido debe tener fecha
    severity: error

  - id: INV-CG-002
    name: cumplido_requiere_evidencia
    rule: estado = 'Cumplido' → evidencia_cumplimiento IS NOT NULL
    description: Cumplimiento requiere evidencia
    severity: warning

  - id: INV-CG-003
    name: prorroga_requiere_fecha
    rule: prorroga_solicitada = TRUE → nueva_fecha_limite IS NOT NULL
    description: Prórroga requiere nueva fecha
    severity: error

  - id: INV-CG-004
    name: verificacion_post_cumplimiento
    rule: verificador_id IS NOT NULL → fecha_cumplimiento IS NOT NULL
    description: Solo se verifica después de cumplir

lifecycle:
  states:
    - name: Pendiente
      description: Asignado, sin iniciar
    - name: EnProgreso
      description: Trabajo en curso
    - name: Cumplido
      description: Completado y verificado
    - name: CumplidoParcial
      description: Avance parcial aceptado
    - name: NoCumplido
      description: No realizado en plazo
    - name: Cancelado
      description: Anulado por decisión
    - name: Prorrogado
      description: Plazo extendido

morphisms:
  originado_en: [ENT-GESTION-INSTANCIA]
  asignado_a: [ENT-BACK-FUNCIONARIO]
  genera: [ENT-GESTION-OPORTUNIDAD-MEJORA]
  verificado_por: [ENT-BACK-FUNCIONARIO]

audit:
  fields_tracked:
    - estado
    - fecha_cumplimiento
    - porcentaje_avance
  retention_years: 5
