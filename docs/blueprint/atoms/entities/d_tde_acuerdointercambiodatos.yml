# ==============================================================================
# GORE_OS Entity Atom: AcuerdoIntercambioDatos (Acuerdo de Intercambio)
# ==============================================================================
# Domain: D-TDE (Gobernanza Digital)
# Subdomain: M3 Interoperabilidad
# Source: dialogo_riguroso_d_tde.md
# ==============================================================================

_metadata:
  version: "1.0.0"
  status: active
  created_at: "2025-12-22"
  created_by: "Arquitecto Categórico + DigiTrans"
  domain: D-TDE
  subdomain: interoperabilidad
  kb_source:
    - "dialogo_riguroso_d_tde.md"
    - "Ley 21.180: Interoperabilidad institucional"

entity:
  id: ENT-TDE-ACUERDO-INTERCAMBIO
  name: AcuerdoIntercambioDatos
  name_es: Acuerdo de Intercambio de Datos
  description: |
    Convenio formal entre instituciones para el intercambio
    de datos a través de PISEE u otro mecanismo.

    Requisitos:
    - Base legal que autoriza el intercambio
    - Definición de datos a intercambiar
    - Responsabilidades de seguridad
    - Plazos de retención

  purpose: |
    Formalizar acuerdos para:
    - Documentar base legal
    - Establecer responsabilidades
    - Cumplir protección de datos
    - Auditar intercambios

  categorical_type: Object
  is_abstract: false
  category: Transactional

attributes:
  - name: id_acuerdo
    type: String
    key: true

  - name: codigo
    type: String
    nullable: true
    description: "Código del convenio"

  - name: nombre
    type: String
    nullable: false

  # Partes
  - name: institucion_origen
    type: String
    nullable: false
    description: Institución que provee datos

  - name: rut_origen
    type: String
    nullable: true

  - name: institucion_destino
    type: String
    nullable: false
    description: Institución que recibe datos

  - name: rut_destino
    type: String
    nullable: true

  - name: contacto_origen
    type: String
    nullable: true

  - name: contacto_destino
    type: String
    nullable: true

  # Base legal
  - name: base_legal
    type: Text
    nullable: false
    description: Normativa que autoriza el intercambio

  - name: finalidad
    type: Text
    nullable: false
    description: Finalidad del intercambio de datos

  # Datos
  - name: datos_intercambiados
    type: JSON
    nullable: true
    description: |
      Descripción de datos:
      [{
        "campo": "...",
        "tipo_dato": "...",
        "sensibilidad": "..."
      }]

  - name: contiene_datos_personales
    type: Boolean
    default: false

  - name: contiene_datos_sensibles
    type: Boolean
    default: false

  # Seguridad
  - name: medidas_seguridad
    type: Text
    nullable: true
    description: Medidas de seguridad aplicables

  - name: cifrado_requerido
    type: Boolean
    default: true

  # Vigencia
  - name: fecha_inicio
    type: Date
    nullable: false

  - name: fecha_termino
    type: Date
    nullable: true

  - name: renovacion_automatica
    type: Boolean
    default: false

  - name: vigente
    type: Boolean
    computed: true
    formula: fecha_termino IS NULL OR fecha_termino >= TODAY()

  # Estado
  - name: estado
    type: Enum[Borrador, EnRevision, Firmado, Vigente, Vencido, Terminado]
    default: Borrador

  - name: acto_administrativo_id
    type: String
    fk: ENT-NORM-ACTO
    nullable: true
    description: Resolución que aprueba el convenio

  # Responsables
  - name: responsable_gore_id
    type: String
    fk: ENT-BACK-FUNCIONARIO
    nullable: true

invariants:
  - id: INV-AID-001
    name: vigente_requiere_firma
    rule: estado = 'Vigente' → acto_administrativo_id IS NOT NULL
    description: Acuerdo vigente debe tener acto aprobatorio

  - id: INV-AID-002
    name: personales_requiere_finalidad
    rule: contiene_datos_personales = TRUE → finalidad IS NOT NULL
    description: Datos personales requieren finalidad explícita

morphisms:
  regula: [ENT-TDE-SERVICIO-PISEE]
  aprobado_por: [ENT-NORM-ACTO]

audit:
  fields_tracked:
    - estado
    - vigente
  retention_years: 10
