# ==============================================================================
# GORE_OS Entity Atom: ControlSeguridad (Control de Seguridad)
# ==============================================================================
# Domain: D-SEG (Ciberseguridad)
# Subdomain: M4 Cumplimiento y Controles
# Source: dialogo_riguroso_d_seg.md, ISO 27002, ENS
# ==============================================================================

_metadata:
  version: "1.0.0"
  status: active
  created_at: "2025-12-22"
  created_by: "Arquitecto Categórico + CISO Virtual"
  domain: D-SEG
  subdomain: cumplimiento
  kb_source:
    - "ISO/IEC 27002: Information security controls"
    - "ENS (Esquema Nacional de Seguridad)"
    - "dialogo_riguroso_d_seg.md"

entity:
  id: ENT-SEG-CONTROL
  name: ControlSeguridad
  name_es: Control de Seguridad
  description: |
    Medida de seguridad física, técnica o administrativa diseñada
    para proteger activos de información y tratar riesgos.

    Ejemplos:
    - Firewall Perimetral
    - Política de Contraseñas
    - Backup Diario
    - Capacitación en Phishing

  purpose: |
    Gestionar controles para:
    - Implementar Plan de Tratamiento de Riesgos
    - Cumplir normativa (SoA - Statement of Applicability)
    - Verificar eficacia de medidas (Auditoría)

  categorical_type: Object
  is_abstract: false
  category: Configuration

attributes:
  - name: id_control
    type: String
    key: true
    description: "ID interno o estándar (ej: ISO-A.5.1)"

  - name: nombre
    type: String
    nullable: false

  - name: descripcion
    type: Text
    nullable: true

  # Clasificación
  - name: tipo_control
    type: Enum[Preventivo, Detectivo, Correctivo, Disuasivo, Recuperacion]
    nullable: false

  - name: categoria_iso
    type: Enum[Organizacional, Personas, Fisico, Tecnologico]
    nullable: true
    description: "Dominios ISO 27002:2022"

  # Normativa
  - name: referencia_normativa
    type: Array[String]
    nullable: true
    description: "Referencias (ej: ISO 27001:A.5.1, ENS:OP.pl.1)"

  # Implementación
  - name: estado_implementacion
    type: Enum[NoIniciado, EnDiseno, EnImplementacion, Operativo, Ineficaz]
    default: NoIniciado

  - name: implementacion_detalles
    type: Text
    nullable: true
    description: "Cómo se implementa técnicamente"

  - name: responsable_implementacion_id
    type: String
    fk: ENT-BACK-FUNCIONARIO
    nullable: true

  # Eficacia
  - name: eficacia_evaluada
    type: Enum[NoEvaluada, Baja, Media, Alta]
    default: NoEvaluada

  - name: fecha_ultima_prueba
    type: Date
    nullable: true
    description: "Fecha último test/auditoría del control"

  # Costo
  - name: costo_implementacion
    type: Decimal
    nullable: true

  - name: costo_recurrente
    type: Decimal
    nullable: true

invariants:
  - id: INV-SEG-CRL-001
    name: operativo_requiere_responsable
    rule: estado_implementacion = 'Operativo' → responsable_implementacion_id IS NOT NULL
    description: Control operativo debe tener responsable asignado

morphisms:
  mitiga: [ENT-SEG-RIESGO]
  protege: [ENT-SEG-ACTIVO-INFORMACION]
  auditado_en: [ENT-GESTION-CONTROL]

audit:
  fields_tracked:
    - estado_implementacion
    - eficacia_evaluada
  retention_years: 5
