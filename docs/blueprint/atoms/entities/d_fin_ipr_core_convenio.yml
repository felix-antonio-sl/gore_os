# Entidad: Convenio (Convenio de Transferencia)
# Domain: D-FIN
# Subdomain: ipr_core
# Generated: 2025-12-21 (Phase 20.1a Core IPR)

id: ENT-FIN-CONVENIO
urn: "urn:goreos:entity:d-fin:convenio:1.0.0"
name: Convenio de Transferencia
domain: D-FIN
subdomain: ipr_core
category: Transactional
canonical_source:
  - "sub_dfin_ipr_core.md#P4-Formalizacion"
  - "Resolución 30/2015 CGR"

description: |
  Instrumento jurídico que formaliza la relación entre GORE y ejecutor.
  Establece obligaciones, plazos, hitos, cronograma y condiciones de rendición.
  Requerido para todas las transferencias a terceros.

attributes:
  - name: id_convenio
    type: String
    key: true

  - name: numero_resolucion
    type: String
    nullable: false
    description: "Resolución GORE que aprueba el convenio"

  - name: fecha_resolucion
    type: Date
    nullable: false

  - name: ipr_id
    type: String
    fk: ENT-FIN-IPR
    nullable: false

  - name: tipo_convenio
    type: Enum[Transferencia, Mandato, Colaboracion, Comodato, Marco]
    nullable: false

  # Partes
  - name: otorgante
    type: String
    default: "GOBIERNO REGIONAL DE ÑUBLE"

  - name: ejecutor_id
    type: String
    fk: ENT-FIN-ACTOR_IPR

  - name: ejecutor_nombre
    type: String
    nullable: false

  - name: representante_ejecutor
    type: String
    nullable: true

  - name: contraparte_gore_id
    type: String
    fk: ROL-FUNCIONARIO
    nullable: true

  # Montos
  - name: monto_total
    type: Decimal
    nullable: false

  - name: numero_cuotas
    type: Integer
    default: 1

  - name: cronograma_pagos
    type: YAML
    nullable: true
    description: Lista de {cuota, monto, condicion, fecha_estimada}

  # Plazos
  - name: fecha_inicio
    type: Date
    nullable: false

  - name: fecha_termino
    type: Date
    nullable: false

  - name: plazo_meses
    type: Integer
    computed: true

  - name: fecha_ultima_prorroga
    type: Date
    nullable: true

  - name: cantidad_prorrogas
    type: Integer
    default: 0

  # Hitos
  - name: hitos
    type: YAML
    nullable: true
    description: Lista de {nombre, fecha, entregable, ponderacion}

  # TDR
  - name: tdr_url
    type: String
    nullable: true
    description: Términos de Referencia adjuntos

  # Estado
  - name: estado
    type: Enum[Borrador, EnFirma, Vigente, EnModificacion, Terminado, Resciliado]
    default: Borrador

  - name: fecha_firma_gore
    type: Date
    nullable: true

  - name: fecha_firma_ejecutor
    type: Date
    nullable: true

  # Modificaciones
  - name: convenio_original_id
    type: String
    fk: ENT-FIN-CONVENIO
    nullable: true
    description: Si es convenio modificatorio

  - name: tipo_modificacion
    type: Enum[AumentoCosto, Prorroga, CambioAlcance, CambioEjecutor]
    nullable: true

  # Garantías
  - name: requiere_garantia
    type: Boolean
    default: false

  - name: garantia_id
    type: String
    fk: ENT-FIN-GARANTIA
    nullable: true

  # Rendición
  - name: plazo_rendicion_dias
    type: Integer
    default: 60
    description: Días desde última cuota (Art. 35 Res. 30)

  - name: porcentaje_rendido
    type: Decimal
    default: 0

invariants:
  - name: plazo_rendicion_legal
    rule: "plazo_rendicion_dias <= 60"
    source: "Res. 30/2015 Art. 35"

  - name: prorroga_justificada
    rule: "IF cantidad_prorrogas > 0 THEN fecha_ultima_prorroga NOT NULL"

  - name: modificacion_tope
    rule: "IF tipo_modificacion = AumentoCosto THEN aumento <= 30% OR requiere_nuevo_proceso"
    source: "sub_dfin_ipr_core.md"

morphisms:
  formaliza: [ENT-FIN-IPR]
  suscrito_por: [GORE, ENT-FIN-ACTOR_IPR]
  genera: [ENT-FIN-TRANSFERENCIA]
  respaldado_por: [ENT-FIN-GARANTIA]
  modificado_por: [ENT-FIN-CONVENIO]

related_processes:
  - "P4-Formalizacion"
  - "P4-bis-Induccion-Ejecutor"
  - "P6-Modificaciones"
