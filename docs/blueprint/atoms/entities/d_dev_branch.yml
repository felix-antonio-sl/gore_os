# ==============================================================================
# GORE_OS Entity Atom: Branch
# ==============================================================================
# Domain: D-DEV (Desarrollo del Sistema)
# Subdomain: Desarrollo de Código (M2)
# ==============================================================================

_metadata:
  version: "1.0.0"
  status: active
  created_at: "2025-12-22"
  created_by: "Ingeniero Software Composicional"
  domain: D-DEV
  subdomain: desarrollo_codigo

entity:
  id: ENT-DEV-BRANCH
  name: Branch
  name_es: Rama de Código
  description: |
    Rama de Git que representa una línea de desarrollo paralela.
    Permite trabajo concurrente aislado antes de integración.

  purpose: |
    Modelar ramas para:
    - Trazabilidad de cambios por feature
    - Gestión de flujo de trabajo Git
    - Aislamiento de desarrollo

  categorical_type: Object
  is_abstract: false
  category: Code

attributes:
  - name: id_branch
    type: String
    key: true

  - name: nombre
    type: String
    nullable: false
    description: "Ej: feature/US-001-login, hotfix/fix-critical-bug"

  - name: repositorio_id
    type: String
    fk: ENT-DEV-REPOSITORIO
    nullable: false

  - name: tipo
    type: Enum[Feature, Bugfix, Hotfix, Release, Develop, Main]
    nullable: false

  - name: base_branch
    type: String
    nullable: false
    description: "Rama desde la que se creó"

  - name: story_id
    type: String
    fk: ENT-DEV-STORY
    nullable: true
    description: "Story vinculada (si aplica)"

  - name: autor_id
    type: String
    fk: ENT-BACK-FUNCIONARIO
    nullable: true

  - name: estado
    type: Enum[Active, Merged, Abandoned]
    default: Active

  - name: fecha_creacion
    type: DateTime
    nullable: false

  - name: fecha_merge
    type: DateTime
    nullable: true

  - name: commits_count
    type: Integer
    computed: true

invariants:
  - id: INV-BRANCH-001
    name: nombre_pattern
    rule: nombre MATCHES '^(feature|bugfix|hotfix|release)/.*$' OR nombre IN ('main', 'develop')
    description: "El nombre debe seguir convención de branching"

  - id: INV-BRANCH-002
    name: main_never_abandoned
    rule: tipo = 'Main' → estado ≠ 'Abandoned'
    description: "La rama main nunca puede abandonarse"

morphisms:
  pertenece_a: [ENT-DEV-REPOSITORIO]
  implementa: [ENT-DEV-STORY]
  contiene_commits: [ENT-DEV-COMMIT]
  genera_pr: [ENT-DEV-PULLREQUEST]

audit:
  fields_tracked:
    - estado
  retention_years: 2
