# Entidad: IPR (Intervención Pública Regional)
# Domain: D-FIN
# Subdomain: ipr_core
# Generated: 2025-12-21 (Phase 20.1a Core IPR)

id: ENT-FIN-IPR
urn: "urn:goreos:entity:d-fin:ipr:1.0.0"
name: Intervención Pública Regional
domain: D-FIN
subdomain: ipr_core
category: Master
is_abstract: true
canonical_source:
  - "urn:knowledge:gorenuble:gn:manual-ipr:1.0.0"
  - "sub_dfin_ipr_core.md"
  - "Ley FNDR, DL 1263/1975"

description: |
  Entidad padre abstracta para todas las intervenciones públicas regionales.
  Se materializa en IDI (Inversión) o PPR (Programa).
  Gestiona ciclo de vida desde Ingreso hasta Cierre.

specializations:
  - ENT-FIN-IDI
  - ENT-FIN-PPR

attributes:
  - name: id_ipr
    type: String
    key: true
    description: Código único de la intervención

  - name: codigo_bip
    type: String
    nullable: true
    description: Código BIP del Banco Integrado de Proyectos (MDSF)

  - name: nombre
    type: String
    nullable: false

  - name: descripcion
    type: Text
    nullable: true

  - name: tipo_ipr
    type: Enum[IDI, PPR]
    nullable: false

  # Clasificación
  - name: mecanismo_id
    type: String
    fk: ENT-FIN-MECANISMO_FINANCIAMIENTO
    nullable: false
    description: Referencia al catálogo de mecanismos (SNI, FRIL, G06, etc.)

  - name: naturaleza_gasto
    type: Enum[Capital, Corriente, Mixto]
    nullable: false

  - name: subtitulo
    type: String
    nullable: false
    description: "31 (IDI), 24 (PPR), 33 (Transferencia Capital)"

  # Ciclo de vida
  - name: fase_actual
    type: Enum[Ingreso, Evaluacion, Financiamiento, Formalizacion, Ejecucion, Modificacion, Cierre]
    default: Ingreso

  - name: estado
    type: Enum[EnTramite, Admisible, Inadmisible, RS, OT, FI, Aprobado, EnEjecucion, Suspendida, Cancelada, Cerrada]

  # Datos del formulador
  - name: entidad_formuladora_id
    type: String
    fk: ENT-GOB-ACTOR
    nullable: true

  - name: ejecutor_id
    type: String
    fk: ENT-FIN-ACTOR_IPR

  - name: tipo_ejecutor
    type: Enum[GORE, Municipio, Servicio, Universidad, ONG, Privado]

  # Montos
  - name: costo_total_estimado
    type: Decimal
    nullable: false

  - name: aporte_gore
    type: Decimal
    nullable: false

  - name: aporte_sectorial
    type: Decimal
    nullable: true

  - name: aporte_propio
    type: Decimal
    nullable: true

  # Fechas
  - name: fecha_ingreso
    type: Date

  - name: fecha_rate
    type: Date
    nullable: true
    description: Fecha de recomendación técnica (RS/RF/ITF)

  - name: fecha_aprobacion_core
    type: Date
    nullable: true

  - name: fecha_inicio_ejecucion
    type: Date
    nullable: true

  - name: fecha_cierre
    type: Date
    nullable: true

  # Evaluación
  - name: rate_tipo
    type: Enum[RS, AD, RF, ITF, FI, OT]
    nullable: true

  - name: evaluacion_id
    type: String
    fk: ENT-FIN-EVALUACION_IPR
    nullable: true

  # Vinculación estratégica
  - name: eje_erd
    type: String
    nullable: true
    description: Eje de la Estrategia Regional de Desarrollo

  - name: es_emblematico
    type: Boolean
    default: false
    description: Proyecto Ñuble 250

  - name: puntaje_impacto_id
    type: String
    fk: ENT-FIN-PUNTAJE_IMPACTO
    nullable: true

  - name: salud_ipr_id
    type: String
    fk: ENT-FIN-SALUD_IPR
    nullable: true

invariants:
  - name: monto_positivo
    rule: "costo_total_estimado > 0"

  - name: aporte_gore_no_excede
    rule: "aporte_gore <= costo_total_estimado"

  - name: fase_estado_consistente
    rule: |
      IF estado = EnEjecucion THEN fase_actual IN (Ejecucion, Modificacion)
      IF estado = Cerrada THEN fase_actual = Cierre

morphisms:
  ejecutado_por: [ENT-FIN-ACTOR_IPR]
  evaluado_por: [ENT-FIN-EVALUACION_IPR]
  formalizado_en: [ENT-FIN-CONVENIO]
  financiado_por: [ENT-FIN-CDP]
  monitoreado_por: [ENT-FIN-SALUD_IPR, ENT-FIN-PUNTAJE_IMPACTO]
  genera: [ENT-FIN-TRANSFERENCIA, ENT-FIN-ESTADO_PAGO, ENT-FIN-RENDICION]
  vinculado_a: [ERD_Eje, Nuble250]

related_processes:
  - "P1-Ingreso-Pertinencia-Admisibilidad"
  - "P2-Evaluacion-Tecnico-Economica"
  - "P3-Obtencion-Financiamiento"
  - "P4-Formalizacion"
  - "P5-Ejecucion"
  - "P6-Modificaciones"
  - "P7-Cierre"
