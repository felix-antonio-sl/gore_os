# ==============================================================================
# GORE_OS Entity Atom: ComunicacionOficial
# ==============================================================================
# Domain: D-TDE (Transformación Digital del Estado)
# Subdomain: Plataformas Compartidas - DocDigital
# Source: KB-026 DocDigital
# ==============================================================================

_metadata:
  version: "1.0.0"
  status: active
  created_at: "2025-12-22"
  created_by: "Arquitecto Categórico + DigiTrans"
  domain: D-TDE
  subdomain: plataformas_docdigital
  kb_source:
    - "urn:knowledge:tde:lineamientos:plataforma_docdigital:1.0.0"
    - "dialogo_plataformas_d_tde.md"

entity:
  id: ENT-TDE-COMUNICACION-OFICIAL
  name: ComunicacionOficial
  name_es: Comunicación Oficial
  description: |
    Oficio, resolución, convenio u otra comunicación formal entre órganos de la
    Administración del Estado, gestionada a través de DocDigital.

    Obligatoria para comunicaciones oficiales entre OAEs según STD 2025.

  purpose: |
    Modelar comunicaciones oficiales para:
    - Trazabilidad documental interinstitucional
    - Integración con expediente electrónico
    - Cumplimiento STD 2025
    - Gestión de oficinas de partes

  categorical_type: Document
  is_abstract: false
  category: Transactional

attributes:
  # Identificación
  - name: id_comunicacion
    type: String
    key: true

  # Tipificación
  - name: tipo
    type: Enum[Oficio, Resolucion, Convenio, Providencia, Memorandum, Otro]
    nullable: false

  - name: numero
    type: String
    nullable: true
    description: "Número de documento (ej: OF. ORD. 123)"

  - name: materia
    type: String
    nullable: false
    description: "Asunto de la comunicación"

  # Contenido
  - name: contenido
    type: Text
    nullable: true

  - name: adjuntos_count
    type: Integer
    default: 0

  # Temporalidad
  - name: fecha_emision
    type: Date
    nullable: false

  - name: fecha_envio
    type: Timestamp
    nullable: true

  - name: fecha_recepcion
    type: Timestamp
    nullable: true

  # Partes
  - name: emisor_oficina_id
    type: String
    fk: ENT-TDE-OFICINA-PARTE
    nullable: false

  - name: receptor_oficina_id
    type: String
    fk: ENT-TDE-OFICINA-PARTE
    nullable: false

  - name: funcionario_emisor_id
    type: String
    fk: ENT-BACK-FUNCIONARIO
    nullable: true
    description: "Funcionario que envía"

  # Estado
  - name: estado
    type: Enum[Borrador, Enviado, Recibido, Leido, Archivado, Rechazado]
    default: Borrador

  # Expediente
  - name: expediente_id
    type: String
    fk: ENT-TDE-EXPEDIENTE-ELECTRONICO
    nullable: true
    description: "Si forma parte de un expediente"

invariants:
  - id: INV-COM-001
    name: envio_requiere_numero
    rule: estado != 'Borrador' → numero IS NOT NULL
    description: "Comunicaciones enviadas deben tener número"

  - id: INV-COM-002
    name: recepcion_despues_envio
    rule: fecha_recepcion IS NULL OR fecha_recepcion >= fecha_envio
    description: "No puede recibirse antes de enviarse"

morphisms:
  emitida_por: [ENT-TDE-OFICINA-PARTE]
  recibida_por: [ENT-TDE-OFICINA-PARTE]
  pertenece_a: [ENT-TDE-EXPEDIENTE-ELECTRONICO]

audit:
  fields_tracked:
    - estado
    - fecha_envio
    - fecha_recepcion
  retention_years: 10
  legal_basis: "STD 2025, Norma Técnica Documentos/Expedientes"
