# ==============================================================================
# GORE_OS Entity Atom: BitacoraIntervencion (Bitácora de Intervención)
# ==============================================================================
# Domain: FENIX (Unidad de Intervención Institucional)
# Subdomain: Core
# Source: domain_fenix.md, dialogo_riguroso_fenix.md
# ==============================================================================

_metadata:
  version: "1.0.0"
  status: active
  created_at: "2025-12-22"
  created_by: "Arquitecto Categórico + AR Virtual"
  domain: FENIX
  subdomain: core
  kb_source:
    - "domain_fenix.md"
    - "dialogo_riguroso_fenix.md"

entity:
  id: ENT-FENIX-BITACORA
  name: BitacoraIntervencion
  name_es: Bitácora de Intervención
  description: |
    Registro cronológico de actividades, decisiones e hitos
    durante una intervención institucional.

    Tipos de entrada:
    - DIAGNOSTICO: Hallazgos de evaluación
    - DECISION: Decisiones tomadas
    - ACCION: Acciones ejecutadas
    - HITO: Logros alcanzados
    - IMPEDIMENTO: Obstáculos encontrados
    - COMUNICACION: Comunicaciones relevantes
    - ESCALAMIENTO: Escalamientos realizados

  purpose: |
    Registrar bitácora para:
    - Trazar cronología de la intervención
    - Documentar decisiones y acciones
    - Identificar impedimentos
    - Generar informe de cierre

  categorical_type: Object
  is_abstract: false
  category: Transactional

attributes:
  - name: id_entrada
    type: String
    key: true
    description: "Identificador único de entrada"

  - name: intervencion_id
    type: String
    fk: ENT-FENIX-INTERVENCION
    nullable: false
    description: Intervención a la que pertenece

  - name: fecha
    type: DateTime
    nullable: false
    description: Fecha y hora del registro

  # Clasificación
  - name: tipo
    type: Enum[Diagnostico, Decision, Accion, Hito, Impedimento, Comunicacion, Escalamiento]
    nullable: false
    description: Tipo de entrada

  - name: impacto
    type: Enum[Critico, Alto, Medio, Bajo, Informativo]
    default: Informativo
    description: Nivel de impacto

  # Contenido
  - name: titulo
    type: String
    nullable: true
    description: Título breve

  - name: descripcion
    type: Text
    nullable: false
    description: Detalle de la actividad o evento

  # Responsabilidad
  - name: responsable_id
    type: String
    fk: ENT-BACK-FUNCIONARIO
    nullable: false
    description: Quien registra la entrada

  # Evidencia
  - name: evidencia_url
    type: String
    nullable: true
    description: URL a documento de respaldo

  - name: adjuntos
    type: Array[String]
    nullable: true
    description: URLs de archivos adjuntos

  # Seguimiento
  - name: requiere_seguimiento
    type: Boolean
    default: false
    description: ¿Requiere acción posterior?

  - name: seguimiento_id
    type: String
    nullable: true
    description: ID de entrada de seguimiento

  - name: seguimiento_completado
    type: Boolean
    default: false

  # Vinculación
  - name: compromiso_generado_id
    type: String
    fk: ENT-GESTION-COMPROMISO
    nullable: true
    description: Compromiso generado si aplica

invariants:
  - id: INV-BIT-001
    name: seguimiento_requiere_accion
    rule: requiere_seguimiento = TRUE → seguimiento_id IS NOT NULL OR seguimiento_completado = FALSE
    description: Seguimiento pendiente o referenciado

morphisms:
  pertenece_a: [ENT-FENIX-INTERVENCION]
  registrado_por: [ENT-BACK-FUNCIONARIO]
  genera: [ENT-GESTION-COMPROMISO]

audit:
  fields_tracked:
    - tipo
    - impacto
  retention_years: 10
