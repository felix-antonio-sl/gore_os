# ETL Mapping: Documentos (Partes) → GORE_OS
# Prioridad: MEDIA (Gestión Documental)
# Funtor: Δ*(MLEG-DOCUMENTO) → Σ*(ENT-SYS-DOCUMENTO)
---
_meta:
  urn: urn:goreos:etl:map:documentos:1.0.0
  type: ETL_Mapping
  created_at: "2025-12-23"
  author: Arquitecto-GORE

source:
  type: staging
  entity: ENT-MLEG-DOCUMENTO
  urn: urn:goreos:etl:sink:mleg_documento:1.0.0
  approx_rows: 12806
  quality_tier: HIGH

target:
  type: canonical
  entity: ENT-SYS-DOCUMENTO
  domain: D-SYS

key_strategy:
  source_key: [tipo_documento, folio, anio]
  target_key: id_documento
  generation: UUID_V5
  namespace: gore_os
  name_template: "documento:{tipo_documento}:{folio}:{anio}"
  dedup_policy: KEEP_FIRST

field_mappings:
  - source: tipo_documento
    target: tipo
    transform: ENUM_MAP
    enum_map:
      OFICIO: OFICIO
      MEMO: MEMORANDUM
      DECRETO: DECRETO
      RESOLUCION: RESOLUCION
      CARTA: CARTA
      ORD: ORDINARIO
      PROVIDENCIA: PROVIDENCIA
      CIRCULAR: CIRCULAR
      ACTA: ACTA
    default: OTRO

  - source: folio
    target: numero
    transform: NORMALIZE_FOLIO
    description: Normaliza folio a formato estandar con ceros

  - source: anio
    target: anio
    transform: IDENTITY

  - source: fecha_documento
    target: fecha
    transform: PARSE_DATE
    formats: ["DD-MM-YYYY", "DD/MM/YYYY", "YYYY-MM-DD"]

  - source: materia
    target: asunto
    transform: TRIM

  - source: remitente
    target: metadata_remitente
    transform: TRIM

  - source: destinatario
    target: metadata_destinatario
    transform: TRIM

  - source: url_documento
    target: url_repositorio
    transform: IDENTITY

  - source: estado
    target: estado
    transform: ENUM_MAP
    enum_map:
      TRAMITADO: TRAMITADO
      PENDIENTE: PENDIENTE
      ARCHIVADO: ARCHIVADO
    default: PENDIENTE

validation_rules:
  - rule: NOT_NULL
    fields: [tipo, numero, anio]
  - rule: UNIQUE
    fields: [tipo, numero, anio]
    scope: GLOBAL
  - rule: RANGE
    field: anio
    min: 2010
    max: 2026

expected_metrics:
  source_rows: 12806
  target_rows_min: 12000
  target_rows_max: 12806
  null_rate_max:
    fecha: 0.05
    url_repositorio: 0.30
