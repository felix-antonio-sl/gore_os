_meta:
  urn: urn:goreos:entity:unknown:unknown:1.0.0
  type: Entity
  schema: urn:goreos:schema:entity:1.0.0
category: Master
is_abstract: false
attributes:
- name: id_expediente
  type: String
  key: true
  description: Identificador interno GORE_OS
- name: iuie
  type: String
  nullable: false
  unique: true
  description: 'Identidad Única del Estado (IUIe).

    Formato: [COD_INST]-[AÑO]-[TIPO]-[CORRELATIVO]

    Ejemplo: GORENUBLE-2025-RES-00001

    '
- name: codigo_corto
  type: String
  nullable: true
  description: Código interno corto
- name: tipo_procedimiento_id
  type: String
  fk: ENT-TDE-PROCEDIMIENTO
  nullable: false
  description: Procedimiento administrativo (CPAT)
- name: materia
  type: String
  nullable: true
  description: Materia o asunto del expediente
- name: clasificacion
  type: Enum[Publico, Reservado, Secreto]
  default: Publico
  description: Clasificación de acceso
- name: estado
  type: Enum[Iniciado, EnTramite, Suspendido, Cerrado, Archivado, Anulado]
  default: Iniciado
  description: Estado del expediente
- name: subestado
  type: String
  nullable: true
  description: Subestado específico del procedimiento
- name: total_folios
  type: Integer
  default: 0
  description: Total de folios (documentos) en el expediente
- name: ultimo_folio
  type: Integer
  default: 0
  description: Número del último folio agregado
- name: hash_integridad
  type: String
  nullable: true
  description: Hash SHA-256 de todos los documentos
- name: fecha_ultimo_hash
  type: DateTime
  nullable: true
  description: Fecha del último cálculo de hash
- name: fecha_creacion
  type: DateTime
  nullable: false
  description: Fecha de inicio del expediente
- name: fecha_cierre
  type: DateTime
  nullable: true
  description: Fecha de cierre del expediente
- name: fecha_archivado
  type: DateTime
  nullable: true
  description: Fecha de paso a archivo
- name: plazo_legal_dias
  type: Integer
  nullable: true
  description: Plazo legal para resolver (si aplica)
- name: dias_transcurridos
  type: Integer
  computed: true
  formula: DATEDIFF(NOW(), fecha_creacion)
- name: en_plazo
  type: Boolean
  computed: true
  formula: dias_transcurridos <= plazo_legal_dias
- name: custodia_actual_id
  type: String
  fk: ENT-BACK-FUNCIONARIO
  nullable: false
  description: Funcionario responsable actual
- name: unidad_tramitadora_id
  type: String
  fk: ENT-BACK-DIVISION
  nullable: false
  description: División que tramita
- name: rut_interesado
  type: String
  nullable: true
  description: RUT del ciudadano o entidad interesada
- name: nombre_interesado
  type: String
  nullable: true
- name: email_interesado
  type: String
  nullable: true
  description: Para notificaciones electrónicas
- name: expediente_padre_id
  type: String
  fk: ENT-TDE-EXPEDIENTE
  nullable: true
  description: Expediente padre si es subexpediente
- name: acto_administrativo_id
  type: String
  fk: ENT-NORM-ACTO
  nullable: true
  description: Acto administrativo resultante
- name: tipo_archivo
  type: Enum[Central, Historico, Intermedio]
  nullable: true
  description: Tipo de archivo donde se conserva
- name: retencion_años
  type: Integer
  default: 5
  description: Años de retención según tabla
invariants:
- id: INV-EXP-001
  name: iuie_unico
  rule: UNIQUE(iuie)
  description: IUIe debe ser único en todo el Estado
  severity: error
- id: INV-EXP-002
  name: cerrado_requiere_cierre
  rule: estado = 'Cerrado' → fecha_cierre IS NOT NULL
  description: Expediente cerrado debe tener fecha de cierre
- id: INV-EXP-003
  name: archivado_requiere_fecha
  rule: estado = 'Archivado' → fecha_archivado IS NOT NULL
  description: Expediente archivado debe tener fecha
- id: INV-EXP-004
  name: foliado_consistente
  rule: total_folios = COUNT(DocumentoElectronico WHERE expediente_id = this.id)
  description: Total folios debe coincidir con documentos
  severity: warning
