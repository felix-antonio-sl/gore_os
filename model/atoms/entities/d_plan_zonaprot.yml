# ==============================================================================
# GORE_OS Entity Atom: ZonaPROT (Zona del Plan de Ordenamiento Territorial)
# ==============================================================================
# Domain: D-PLAN (Strategic Planning)
# Subdomain: Ordenamiento Territorial
# Source: domain_d-plan.md P3, LOC GORE Art. 17, dialogo_dplan_dterr.md
# ==============================================================================

_metadata:
  version: "1.0.0"
  status: active
  created_at: "2025-12-21"
  created_by: "Arquitecto Categórico + Gobernador Virtual"
  domain: D-PLAN
  subdomain: ordenamiento_territorial
  kb_source:
    - "domain_d-plan.md P3"
    - "LOC GORE Art. 17"
    - "dialogo_dplan_dterr.md"

entity:
  id: ENT-PLAN-ZONA-PROT
  name: ZonaPROT
  name_es: Zona del Plan Regional de Ordenamiento Territorial
  description: |
    Representa una zona de uso definida en el PROT (Plan Regional de
    Ordenamiento Territorial), instrumento vinculante según Art. 17 LOC GORE.

    Cada zona tiene usos permitidos, condicionados y prohibidos que
    deben validarse al evaluar proyectos de inversión.

  purpose: |
    Modelar zonas PROT para:
    - Validar compatibilidad de IPRs con zonificación
    - Alertar proyectos en zonas incompatibles
    - Consulta pública de aptitud territorial
    - Integración con D-TERR (IDE)

  categorical_type: Object
  is_abstract: false
  category: Reference

attributes:
  - name: id_zona
    type: String
    key: true
    description: Identificador único de la zona

  - name: prot_id
    type: String
    nullable: false
    description: PROT al que pertenece

  - name: codigo_zona
    type: String
    nullable: false
    description: Código en el instrumento (ej. ZU-01)

  - name: nombre
    type: String
    nullable: false
    description: Nombre de la zona

  - name: macrozona
    type: String
    nullable: false
    description: Macrozona contenedora

  # Clasificación de uso
  - name: tipo_uso
    type: Enum[PreferenteUrbano, PreferenteRural, Conservacion, Restriccion, Mixto, Especial]
    nullable: false
    description: Clasificación principal de uso

  - name: usos_permitidos
    type: Array[String]
    nullable: true
    description: Usos permitidos sin condición

  - name: usos_condicionados
    type: Array[String]
    nullable: true
    description: Usos que requieren evaluación

  - name: usos_prohibidos
    type: Array[String]
    nullable: true
    description: Usos expresamente prohibidos

  - name: condiciones_vinculantes
    type: Text
    nullable: true
    description: Condiciones legales vinculantes

  # Geometría
  - name: geometria
    type: Geometry
    geometry_type: Polygon
    nullable: false
    description: Polígono de la zona

  - name: superficie_ha
    type: Decimal
    nullable: true
    description: Superficie en hectáreas

  # Riesgo
  - name: restriccion_riesgo
    type: Enum[Sin, Inundacion, Remocion, Incendio, Multiple]
    default: Sin
    description: Restricción por riesgo aplicable

  # Estado
  - name: estado
    type: Enum[Borrador, Vigente, EnActualizacion, Derogada]
    default: Vigente
    description: Estado de la zona

  # Comunas
  - name: comunas_abarcadas
    type: Array[String]
    nullable: true
    description: Comunas que intersecta la zona

invariants:
  - id: INV-ZPROT-001
    name: geometria_valida
    rule: ST_IsValid(geometria) = true
    description: La geometría debe ser válida
    severity: error

  - id: INV-ZPROT-002
    name: codigo_unico_por_prot
    rule: UNIQUE(prot_id, codigo_zona)
    description: Código único dentro del PROT
    severity: error

morphisms:
  pertenece_a: [PROT]
  intersecta: [ENT-TERR-COMUNA]
  restringe: [ENT-FIN-IPR]
  publicada_en: [ENT-TERR-CAPA]

audit:
  fields_tracked:
    - estado
    - tipo_uso
  retention_years: 20
