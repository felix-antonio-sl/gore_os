_meta:
  urn: urn:goreos:entity:unknown:unknown:1.0.0
  type: Entity
  schema: urn:goreos:schema:entity:1.0.0
category: Master
is_abstract: false
attributes:
- name: id_compromiso
  type: String
  key: true
  description: Identificador único del compromiso
- name: numero_compromiso
  type: String
  nullable: false
  description: Número secuencial del año (ej. COMP-2025-00145)
- name: fecha_compromiso
  type: Date
  nullable: false
  description: Fecha de registro del compromiso
- name: cdp_id
  type: String
  fk: ENT-FIN-CDP
  nullable: false
  description: Certificado de Disponibilidad Presupuestaria que respalda
- name: imputacion_presupuestaria
  type: String
  nullable: false
  description: Código clasificador presupuestario (ej. 22.04.001)
- name: programa_presupuestario
  type: String
  nullable: true
  description: Programa específico si aplica
- name: monto_comprometido
  type: Decimal
  nullable: false
  description: Monto total del compromiso en CLP
- name: moneda
  type: Enum[CLP, UF, USD, EUR]
  default: CLP
  description: Moneda del compromiso
- name: monto_devengado_acumulado
  type: Decimal
  default: 0
  description: Suma de devengos realizados contra este compromiso
- name: saldo_por_devengar
  type: Decimal
  computed: true
  formula: monto_comprometido - monto_devengado_acumulado
  description: Monto pendiente de devengar
- name: tipo_acto_generador
  type: Enum[OrdenCompra, Contrato, Resolucion, Convenio, BoletaGarantia, Honorario]
  nullable: false
  description: Tipo de documento que origina el compromiso
- name: acto_id
  type: String
  fk: ENT-FIN-ACTO-ADMIN
  nullable: false
  description: ID del acto administrativo generador
- name: numero_documento_externo
  type: String
  nullable: true
  description: Número de OC en ChileCompra, número de contrato, etc.
- name: beneficiario_rut
  type: String
  nullable: false
  description: RUT del proveedor/contratista/beneficiario
- name: beneficiario_nombre
  type: String
  nullable: false
  description: Razón social o nombre del beneficiario
- name: ipr_id
  type: String
  fk: ENT-FIN-IPR
  nullable: true
  description: IPR asociada si el gasto corresponde a un proyecto
- name: convenio_id
  type: String
  fk: ENT-FIN-CONVENIO
  nullable: true
  description: Convenio de transferencia si aplica
- name: folio_sigfe
  type: String
  nullable: true
  description: ID de la transacción en sistema nacional SIGFE
- name: id_mercado_publico
  type: String
  nullable: true
  description: ID de la orden de compra en Mercado Público
- name: estado
  type: Enum[Vigente, ParcialmenteDevengado, TotalmenteDevengado, Anulado, Rebajado]
  default: Vigente
  description: Estado del ciclo de vida del compromiso
- name: fecha_anulacion
  type: Date
  nullable: true
  description: Fecha de anulación si aplica
- name: motivo_anulacion
  type: String
  nullable: true
  description: Justificación de la anulación
- name: glosa
  type: String
  nullable: false
  description: Descripción del objeto del gasto
- name: usuario_registro
  type: String
  nullable: false
  description: Usuario que registró el compromiso
- name: fecha_registro
  type: DateTime
  nullable: false
  description: Timestamp de creación
invariants:
- id: INV-COMP-001
  name: compromiso_no_excede_cdp
  rule: 'monto_comprometido <= cdp.saldo_disponible

    '
  description: El compromiso no puede exceder el saldo disponible del CDP
  source: DL 1263/1975 Art. 19
  severity: error
- id: INV-COMP-002
  name: devengo_no_excede_compromiso
  rule: 'monto_devengado_acumulado <= monto_comprometido

    '
  description: Los devengos no pueden superar el monto comprometido
  severity: error
- id: INV-COMP-003
  name: acto_requerido
  rule: 'acto_id IS NOT NULL

    '
  description: Todo compromiso requiere un acto administrativo de respaldo
  severity: error
- id: INV-COMP-004
  name: estado_coherente_devengo
  rule: '(monto_devengado_acumulado = 0) → estado = ''Vigente''

    (monto_devengado_acumulado > 0 AND monto_devengado_acumulado < monto_comprometido)
    → estado = ''ParcialmenteDevengado''

    (monto_devengado_acumulado = monto_comprometido) → estado = ''TotalmenteDevengado''

    '
  description: El estado debe reflejar el nivel de devengo
- id: INV-COMP-005
  name: anulacion_sin_devengos
  rule: '(estado = ''Anulado'') → monto_devengado_acumulado = 0

    '
  description: Solo se puede anular un compromiso sin devengos registrados
  severity: error
