# ==============================================================================
# GORE_OS Entity Atom: Compromiso (Gestión de Compromisos)
# ==============================================================================
# Domain: D-EJEC (Execution & Monitoring)
# Subdomain: Gestión de Compromisos
# Source: domain_d-ejec.md, Módulo 4: Gestión de Compromisos
# ==============================================================================

_metadata:
  version: "1.0.0"
  status: active
  created_at: "2025-12-21"
  created_by: "Arquitecto Categórico"
  domain: D-EJEC
  subdomain: compromisos
  kb_source:
    - "domain_d-ejec.md"
    - "User Stories: US-EJEC-AR-xxx, US-EJEC-EO-xxx"

entity:
  id: ENT-EJEC-COMPROMISO
  name: Compromiso
  name_es: Compromiso de Gestión
  description: |
    Tarea, acuerdo o hito crítico adquirido por una autoridad o funcionario
    ante la ciudadanía, el CORE o actores externos. Permite trazabilidad
    política y operativa más allá de los flujos BPMN rígidos.

  purpose: |
    - Trazar acuerdos informales que se vuelven mandatorios
    - Semaforizar cumplimiento para el Gobernador/CORE
    - Evitar "promesas olvidadas" en visitas a terreno

  categorical_type: Object
  is_abstract: false
  category: Event

attributes:
  - name: id_compromiso
    type: String
    key: true
    description: Identificador único

  - name: descripcion
    type: Text
    nullable: false
    description: Qué se prometió hacer

  - name: origen
    type: Enum[SesionCORE, VisitaTerreno, ReunionLobby, Gabinete, SolicitudCiudadana, Otro]
    nullable: false
    description: Contexto donde nace el compromiso

  - name: prioridad
    type: Enum[Baja, Media, Alta, Critica]
    default: Media
    description: Urgencia política/técnica

  - name: fecha_creacion
    type: Date
    default: now()
    description: Cuándo se adquirió

  - name: fecha_limite
    type: Date
    nullable: true
    description: Deadline para el cumplimiento

  - name: responsable_id
    type: String
    fk: ENT-BACK-FUNCIONARIO
    nullable: false
    description: Funcionario a cargo de resolverlo

  - name: ipr_id
    type: String
    fk: ENT-FIN-IPR
    nullable: true
    description: IPR relacionado (opcional)

  - name: comuna_id
    type: String
    fk: ENT-TERR-COMUNA
    nullable: true
    description: Territorio afectado

  - name: estado
    type: Enum[Pendiente, EnProgreso, Bloqueado, Completado, Desestimado, Vencido]
    default: Pendiente
    description: Estado de avance

  - name: evidencia_cierre
    type: String
    nullable: true
    description: URL o referencia al documento/foto que prueba el cierre

invariants:
  - id: INV-COM-001
    name: cierre_requiere_evidencia
    rule: |
      (estado = 'Completado') → (evidencia_cierre IS NOT NULL)
    description: No se puede cerrar un compromiso sin prueba
    severity: warning

lifecycle:
  states:
    - name: Pendiente
      description: Creado, aun no iniciado
    - name: EnProgreso
      description: Gestión en curso
    - name: Bloqueado
      description: Detenido por factor externo
    - name: Vencido
      description: Fecha límite superada sin cierre
    - name: Completado
      description: Cumplido satisfactoriamente

morphisms:
  asignado_a: [ENT-BACK-FUNCIONARIO]
  vinculado_a: [ENT-FIN-IPR]
  localizado_en: [ENT-TERR-COMUNA]

audit:
  fields_tracked:
    - estado
    - responsable_id
    - fecha_limite
  retention_years: 5
