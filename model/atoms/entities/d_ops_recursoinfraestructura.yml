# ==============================================================================
# GORE_OS Entity Atom: RecursoInfraestructura (Recurso Infra)
# ==============================================================================
# Domain: D-OPS (Operaciones e Infraestructura)
# Subdomain: M1 Infraestructura (IaC)
# Source: dialogo_profundo_dev_ops.md
# ==============================================================================

_metadata:
  version: "1.0.0"
  status: active
  created_at: "2025-12-22"
  created_by: "Arquitecto Categórico + Ingeniero GORE_OS"
  domain: D-OPS
  subdomain: infrastructure
  kb_source:
    - "CMDB / Asset Management"
    - "dialogo_profundo_dev_ops.md"

entity:
  id: ENT-OPS-RECURSO
  name: RecursoInfraestructura
  name_es: Recurso de Infraestructura TI
  description: |
    Componente físico o virtual que soporta la operación del software.
    Instanciación tecnológica de un ActivoInformacion (Hardware/Servicio).

    Ejemplos:
    - Servidor Linux (VM)
    - Base de Datos (RDS)
    - Load Balancer
    - Bucket S3
    - Cluster Kubernetes

  purpose: |
    Gestionar inventario técnico para:
    - Monitoreo de salud (Up/Down)
    - Gestión de capacidad (Capacity Planning)
    - Gestión de costos Cloud
    - Mapeo de dependencias

  categorical_type: Object
  is_abstract: false
  category: Reference

attributes:
  - name: id_recurso
    type: String
    key: true
    description: "Cloud Resource ID o Hostname"

  - name: nombre
    type: String
    nullable: false

  - name: tipo
    type: Enum[Compute, Database, Storage, Network, Container, Other]
    nullable: false

  - name: proveedor
    type: Enum[AWS, Azure, Google, VMWare, OnPremise]
    nullable: false

  # Relaciones
  - name: ambiente_id
    type: String
    fk: ENT-OPS-AMBIENTE
    nullable: true
    description: "Ambiente al que pertenece"

  - name: activo_informacion_id
    type: String
    fk: ENT-SEG-ACTIVO-INFORMACION
    nullable: true
    description: "Link a Gestión de Activos Seguridad (ISO 27001)"

  # Técnico
  - name: ip_address
    type: String
    nullable: true

  - name: os_version
    type: String
    nullable: true

  - name: specs
    type: JSON
    nullable: true
    description: "{cpu: 4, ram: '16GB', disk: '100GB'}"

  # Estado Operativo
  - name: estado_operativo
    type: Enum[Running, Stopped, Terminated, Maintenance, Failed]
    default: Running

  - name: costo_mensual_estimado
    type: Decimal
    nullable: true

invariants:
  - id: INV-INFRA-001
    name: ip_valida
    rule: ip_address IS NOT NULL → ip_address REGEX '^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$'
    description: IP debe tener formato válido (IPv4 simplificado)

morphisms:
  soporta: [ENT-OPS-AMBIENTE]
  monitoreado_en: [ENT-SEG-EVENTO]

audit:
  fields_tracked:
    - estado_operativo
    - costo_mensual_estimado
  retention_years: 5
