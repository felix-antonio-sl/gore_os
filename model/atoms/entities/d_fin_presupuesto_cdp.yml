_meta:
  urn: urn:goreos:entity:d-fin:cdp:1.0.0
  type: Entity
  schema: urn:goreos:schema:entity:1.0.0
id: ENT-FIN-CDP
urn: urn:goreos:entity:d-fin:cdp:1.0.0
name: Certificado de Disponibilidad Presupuestaria
domain: D-FIN
subdomain: presupuesto
category: Reference
is_abstract: false
attributes:
- name: id_cdp
  type: String
  key: true
- name: numero_cdp
  type: String
  nullable: false
  description: Número secuencial por ejercicio
- name: ejercicio
  type: Integer
  nullable: false
- name: fecha_emision
  type: Date
  nullable: false
- name: fecha_vencimiento
  type: Date
  nullable: true
  description: Fecha límite de uso del CDP
- name: unidad_solicitante
  type: String
  nullable: false
- name: solicitante_id
  type: String
  fk: ROL-FUNCIONARIO
  nullable: true
- name: descripcion
  type: Text
  nullable: false
- name: tipo_gasto
  type: Enum[Inversion, Operacion, Personal, Bienes, Servicios, Transferencia]
  nullable: false
- name: subtitulo
  type: String
  nullable: false
- name: item
  type: String
  nullable: false
- name: asignacion
  type: String
  nullable: true
- name: programa
  type: String
  nullable: true
- name: monto_solicitado
  type: Decimal
  nullable: false
- name: monto_aprobado
  type: Decimal
  nullable: true
- name: moneda
  type: Enum[CLP, UF, UTM]
  default: CLP
- name: ipr_id
  type: String
  fk: ENT-FIN-IPR
  nullable: true
- name: licitacion_id
  type: String
  fk: ENT-FIN-LICITACION
  nullable: true
- name: orden_compra_id
  type: String
  fk: ENT-FIN-ORDEN_COMPRA
  nullable: true
- name: estado
  type: Enum[Solicitado, Emitido, Utilizado, Liberado, Vencido, Anulado]
  default: Solicitado
- name: fecha_utilizacion
  type: Date
  nullable: true
- name: compromiso_id
  type: String
  fk: ENT-FIN-COMPROMISO
  nullable: true
  description: Compromiso que consume este CDP
- name: aprobado_por_id
  type: String
  fk: ROL-JEFE-PRESUPUESTO
  nullable: true
- name: fecha_aprobacion
  type: DateTime
  nullable: true
- name: saldo_disponible
  type: Decimal
  computed: true
  formula: monto_aprobado - monto_comprometido
invariants:
- name: cdp_previo_obligatorio
  rule: Ningún proceso de compra inicia sin CDP vigente
  source: MANUAL-COMPRAS-SEC-II-RESERVA-01
- name: saldo_no_negativo
  rule: saldo_disponible >= 0
- name: vencimiento_anual
  rule: fecha_vencimiento <= 31-12-{ejercicio} OR estado IN (Liberado, Anulado)
