# ==============================================================================
# GORE_OS Entity Atom: ServicioInteroperabilidad
# ==============================================================================
# Domain: D-TDE (Transformación Digital del Estado)
# Subdomain: Plataformas Compartidas - PISEE
# Source: KB-027 Red de Interoperabilidad PISEE
# ==============================================================================

_metadata:
  version: "1.0.0"
  status: active
  created_at: "2025-12-22"
  created_by: "Arquitecto Categórico + DigiTrans"
  domain: D-TDE
  subdomain: plataformas_interoperabilidad
  kb_source:
    - "urn:knowledge:tde:lineamientos:plataforma_pisee_interoperabilidad:1.0.0"
    - "dialogo_plataformas_d_tde.md"

entity:
  id: ENT-TDE-SERVICIO-INTEROPERABILIDAD
  name: ServicioInteroperabilidad
  name_es: Servicio de Interoperabilidad
  description: |
    Servicio informático automatizado registrado en la red PISEE que permite
    interoperar datos, documentos o expedientes entre consumidores y proveedores
    mediante nodos validados.

    Registrado en los servicios centralizados (Catálogo de Servicios).

  purpose: |
    Modelar servicios PISEE para:
    - Catálogo institucional de APIs
    - Gobernanza de interoperabilidad
    - Trazabilidad de consumo/provisión
    - Alineación con Norma Técnica Interoperabilidad

  categorical_type: Service
  is_abstract: false
  category: Integration

attributes:
  # Identificación
  - name: id_servicio
    type: String
    key: true

  - name: codigo_catalogo
    type: String
    nullable: true
    description: "Código en Catálogo de Servicios SGD"

  # Datos
  - name: nombre
    type: String
    nullable: false

  - name: descripcion
    type: Text
    nullable: true

  # Tipo
  - name: tipo
    type: Enum[Datos, Documentos, Expedientes, Mixto]
    nullable: false

  - name: rol_nodo
    type: Enum[Proveedor, Consumidor]
    nullable: false

  # Nodo
  - name: nodo_id
    type: String
    fk: ENT-TDE-NODO-INTEROPERABILIDAD
    nullable: false

  # Técnico
  - name: endpoint
    type: String
    nullable: true
    description: "URL del endpoint"

  - name: metodo
    type: Enum[REST, SOAP]
    default: REST

  - name: version
    type: String
    nullable: true

  # Estado
  - name: estado
    type: Enum[Desarrollo, Pruebas, Produccion, Deprecado, Inactivo]
    default: Desarrollo

  # Fechas
  - name: fecha_publicacion
    type: Date
    nullable: true

  - name: fecha_deprecacion
    type: Date
    nullable: true

  # Métricas
  - name: transacciones_ultimo_mes
    type: Integer
    default: 0

  # Seguridad
  - name: requiere_autenticacion
    type: Boolean
    default: true

  - name: nivel_confidencialidad
    type: Enum[Publico, Interno, Restringido, Confidencial]
    default: Interno

invariants:
  - id: INV-SRV-001
    name: produccion_requiere_endpoint
    rule: estado = 'Produccion' → endpoint IS NOT NULL
    description: "Servicios productivos requieren endpoint"

  - id: INV-SRV-002
    name: deprecado_requiere_fecha
    rule: estado = 'Deprecado' → fecha_deprecacion IS NOT NULL
    description: "Servicios deprecados deben tener fecha"

morphisms:
  publicado_por: [ENT-TDE-NODO-INTEROPERABILIDAD]
  consumido_por: [ENT-TDE-NODO-INTEROPERABILIDAD]
  registrado_en: [ENT-TDE-SGD]

audit:
  fields_tracked:
    - estado
    - transacciones_ultimo_mes
  retention_years: 10
  legal_basis: "Decreto 12, Norma Técnica Interoperabilidad"
