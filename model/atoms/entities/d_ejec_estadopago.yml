_meta:
  urn: urn:goreos:entity:unknown:unknown:1.0.0
  type: Entity
  schema: urn:goreos:schema:entity:1.0.0
category: Master
is_abstract: false
attributes:
- name: id_ep
  type: String
  key: true
  description: Identificador único (ej. EP-2024-001)
- name: convenio_id
  type: String
  fk: ENT-EJEC-CONVENIO
  nullable: false
  description: Convenio asociado
- name: numero_correlativo
  type: Integer
  nullable: false
  description: Número secuencial del EP para este convenio (1, 2, 3...)
- name: tipo_ep
  type: Enum[Anticipo, Parcial, Final, Unico, Devolucion]
  nullable: false
  description: Tipo de estado de pago
- name: monto_bruto_solicitado
  type: Decimal
  nullable: false
  description: Monto solicitado por el ejecutor
- name: monto_aprobado_inspector
  type: Decimal
  nullable: false
  description: Monto validado por el Inspector Fiscal/ITO
- name: retenciones
  type: Decimal
  default: 0
  description: Montos retenidos (ej. garantías, multas)
- name: liquido_pago
  type: Decimal
  computed: true
  formula: monto_aprobado_inspector - retenciones
  description: Monto líquido a transferir
- name: avance_fisico_periodo
  type: Decimal
  description: '% avance físico en este periodo'
- name: avance_fisico_acumulado
  type: Decimal
  description: '% avance físico total acumulado'
- name: avance_financiero_acumulado
  type: Decimal
  description: '% financiero pagado respecto al total convenio'
- name: fecha_ingreso
  type: Date
  nullable: false
  description: Fecha ingreso solicitud
- name: fecha_aprobacion_tecnica
  type: Date
  nullable: true
  description: Fecha V°B° Inspector/ITO
- name: fecha_autorizacion_pago
  type: Date
  nullable: true
  description: Fecha autorización jefatura para pago
- name: estado
  type: Enum[Borrador, Ingresado, EnRevisionTecnica, Observado, AprobadoTecnico, EnProcesoPago,
    Pagado, Rechazado]
  default: Ingresado
  description: Estado del flujo
- name: informe_avance_id
  type: String
  fk: ENT-EJEC-INFORME
  nullable: true
  description: Informe técnico que respalda el EP
- name: devengo_id
  type: String
  fk: ENT-BACK-DEVENGO
  nullable: true
  description: Comprobante contable de devengo (D-BACK)
invariants:
- id: INV-EP-001
  name: monto_liquido_positivo
  rule: liquido_pago >= 0
  description: El líquido a pago no puede ser negativo
  severity: error
- id: INV-EP-002
  name: avance_coherente
  rule: avance_fisico_acumulado <= 100
  description: Avance físico no puede superar 100% (salvo obras extra)
  severity: warning
- id: INV-EP-003
  name: correlativo_unico_convenio
  rule: unique(convenio_id, numero_correlativo)
  description: No pueden existir dos EP con el mismo número para un convenio
  severity: error
