_meta:
  urn: urn:goreos:entity:d-ejec:bitacora-obra:1.0.0
  type: Entity
  schema: urn:goreos:schema:entity:1.0.0
id: ENT-EJEC-BITACORA_OBRA
urn: urn:goreos:entity:d-ejec:bitacora-obra:1.0.0
name: Bitácora de Obra
domain: D-EJEC
category: Operational
is_abstract: false
attributes:
- name: id_entrada
  type: String
  key: true
- name: convenio_id
  type: String
  fk: ENT-FIN-CONVENIO
  nullable: false
- name: numero_entrada
  type: Integer
  nullable: false
- name: fecha_hora
  type: DateTime
  nullable: false
- name: tipo_libro
  type: Enum[LibroObras, LibroComunicaciones, LibroPrevencion, BitacoraDigital]
  default: LibroObras
  description: Distinción legal del cuaderno utilizado
- name: folio_correlativo
  type: Integer
  nullable: false
  description: Numeración única e inmutable dentro del libro específico
- name: tipo_evento
  type: Enum[InicioObra, SuspensionObra, ReanudacionObra, Incidente, CambioAlcance,
    EntregaMaterial, VisitaInspeccion, HitoAlcanzado, ProblemaDetectado, SolucionImplementada,
    ClimaAdverso, TerminoObra, Otro]
  nullable: false
- name: descripcion
  type: Text
  nullable: false
- name: detalle_tecnico
  type: Text
  nullable: true
- name: autor_id
  type: String
  fk: ROL-FUNCIONARIO
  nullable: false
- name: autor_nombre
  type: String
  nullable: false
- name: rol_autor
  type: Enum[SupervisorGORE, RepresentanteEjecutor, ITO, Contratista, Otro]
- name: adjuntos
  type: List[String]
  nullable: true
- name: fotografias
  type: List[String]
  nullable: true
- name: visita_id
  type: String
  fk: ENT-EJEC-VISITA_TERRENO
  nullable: true
- name: hito_id
  type: String
  fk: ENT-EJEC-HITO_CONVENIO
  nullable: true
- name: hash_integridad
  type: String
  nullable: true
  description: Hash SHA-256 para garantizar inmutabilidad
- name: firmado_electronicamente
  type: Boolean
  default: false
invariants:
- name: entrada_inmutable
  rule: Una vez creada, la entrada no puede ser modificada (append-only)
- name: cronologia_estricta
  rule: fecha_hora > MAX(fecha_hora WHERE convenio_id = this.convenio_id)
