_meta:
  urn: urn:goreos:entity:unknown:unknown:1.0.0
  type: Entity
  schema: urn:goreos:schema:entity:1.0.0
category: Master
is_abstract: false
attributes:
- name: id_eipd
  type: String
  key: true
- name: responsable_id
  type: String
  fk: ENT-TDE-RESPONSABLE-TRATAMIENTO
  nullable: false
- name: fecha_realizacion
  type: Date
  nullable: false
- name: tipo_tratamiento_evaluado
  type: String
  nullable: false
  description: Descripción del tratamiento analizado
- name: causal_obligatoriedad
  type: Enum[PerfilamientoAutomatizado, TratamientoMasivo, MonitoreoPublico, DatosSensiblesSinConsentimiento,
    Otro]
  nullable: false
  description: Motivo por el que la EIPD es obligatoria
- name: nivel_riesgo_inherente
  type: Enum[Bajo, Medio, Alto, MuyAlto]
  nullable: false
- name: nivel_riesgo_residual
  type: Enum[Bajo, Medio, Alto, MuyAlto]
  nullable: false
  description: Riesgo después de aplicar mitigaciones
- name: medidas_mitigacion
  type: Array[String]
  nullable: false
- name: requiere_consulta_apdp
  type: Boolean
  computed: true
  formula: nivel_riesgo_residual = 'MuyAlto'
- name: consultado_agencia
  type: Boolean
  default: false
- name: fecha_consulta_agencia
  type: Date
  nullable: true
- name: respuesta_agencia
  type: String
  nullable: true
- name: documento_url
  type: String
  nullable: true
  description: Link al documento completo de la EIPD
- name: version
  type: String
  default: '1.0'
invariants:
- id: INV-EIPD-001
  name: consulta_si_muy_alto
  rule: nivel_riesgo_residual = 'MuyAlto' → consultado_agencia = TRUE
  description: Si el riesgo residual es muy alto, debe consultarse a la APDP
- id: INV-EIPD-002
  name: mitigacion_obligatoria
  rule: LENGTH(medidas_mitigacion) > 0
  description: Debe existir al menos una medida de mitigación
