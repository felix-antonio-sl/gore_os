_meta:
  urn: urn:goreos:entity:unknown:unknown:1.0.0
  type: Entity
  schema: urn:goreos:schema:entity:1.0.0
category: Master
is_abstract: false
attributes:
- name: id_notificacion
  type: String
  key: true
  description: UUID interno
- name: message_data_id
  type: String
  nullable: true
  description: ID retornado por API de Notificaciones
- name: expediente_id
  type: String
  fk: ENT-TDE-EXPEDIENTE-ELECTRONICO
  nullable: true
  description: Expediente al que pertenece la notificación
- name: procedimiento_code
  type: String
  nullable: false
  description: Código CPAT del procedimiento administrativo
- name: etapa_procedimiento
  type: Enum[Inicio, Instruccion, Finalizacion]
  nullable: true
  description: 1=Inicio, 2=Instrucción, 3=Finalización
- name: tipo_mensaje
  type: Enum[NT, CP, CI]
  nullable: false
  description: NT=Notificación, CP=Comunicación Personal, CI=Comunicado Institucional
- name: asunto
  type: String
  nullable: false
  max_length: 150
- name: contenido
  type: Text
  nullable: false
- name: content_type
  type: String
  default: text/html
  description: MIME type del contenido
- name: firma_institucional_uid
  type: String
  nullable: true
  description: UUID de firma institucional configurada
- name: adjuntos_count
  type: Integer
  default: 0
  description: Número de adjuntos (máx. 50)
- name: adjuntos_peso_mb
  type: Decimal
  default: 0
  description: Peso total de adjuntos en MB (máx. 20)
- name: webhook_url
  type: String
  nullable: true
  description: URL para recibir estado del procesamiento
- name: fecha_envio
  type: Timestamp
  nullable: false
- name: fecha_procesado
  type: Timestamp
  nullable: true
- name: estado_global
  type: Enum[pending, processed, delivered, error]
  default: pending
- name: destinatarios_count
  type: Integer
  nullable: false
  description: Número de destinatarios (máx. 250)
- name: entidad_emisora_id
  type: String
  fk: ENT-TDE-ENTIDAD-REGIONAL
  nullable: false
invariants:
- id: INV-NOTIF-001
  name: asunto_max_length
  rule: LENGTH(asunto) <= 150
  description: Asunto no puede exceder 150 caracteres
- id: INV-NOTIF-002
  name: max_destinatarios
  rule: destinatarios_count <= 250
  description: Máximo 250 destinatarios por mensaje
- id: INV-NOTIF-003
  name: max_adjuntos_peso
  rule: adjuntos_peso_mb <= 20
  description: Peso total de adjuntos no puede exceder 20 MB
- id: INV-NOTIF-004
  name: procedimiento_obligatorio_si_notificacion
  rule: tipo_mensaje = 'NT' → procedimiento_code IS NOT NULL
  description: Notificaciones requieren código de procedimiento
