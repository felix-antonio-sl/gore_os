# ==============================================================================
# GORE_OS Entity Atom: ADR (Architecture Decision Record)
# ==============================================================================
# Domain: D-DEV (Desarrollo del Sistema)
# Subdomain: Arquitectura (M3)
# ==============================================================================

_metadata:
  version: "1.0.0"
  status: active
  created_at: "2025-12-22"
  created_by: "Ingeniero Software Composicional"
  domain: D-DEV
  subdomain: arquitectura

entity:
  id: ENT-DEV-ADR
  name: ADR
  name_es: Registro de Decisión de Arquitectura
  description: |
    Documento que registra una decisión arquitectónica significativa
    junto con su contexto y consecuencias.

    Formato: Título, Contexto, Decisión, Consecuencias, Estado.

  purpose: |
    Modelar ADRs para:
    - Trazabilidad de decisiones técnicas
    - Onboarding de nuevos miembros
    - Governance de arquitectura

  categorical_type: Document
  is_abstract: false
  category: Governance

attributes:
  - name: id_adr
    type: String
    key: true

  - name: numero
    type: Integer
    nullable: false
    description: "Número secuencial único"

  - name: titulo
    type: String
    nullable: false

  - name: estado
    type: Enum[Proposed, Accepted, Deprecated, Superseded]
    default: Proposed

  - name: contexto
    type: Text
    nullable: false
    description: "¿Qué problema estamos resolviendo?"

  - name: decision
    type: Text
    nullable: false
    description: "¿Qué decidimos hacer?"

  - name: consecuencias
    type: Text
    nullable: true
    description: "¿Qué trade-offs aceptamos?"

  - name: alternativas_consideradas
    type: Array[String]
    nullable: true

  - name: autor_id
    type: String
    fk: ENT-BACK-FUNCIONARIO
    nullable: true

  - name: fecha_propuesta
    type: Date
    nullable: false

  - name: fecha_decision
    type: Date
    nullable: true

  - name: superseded_by
    type: String
    fk: ENT-DEV-ADR
    nullable: true
    description: "ADR que reemplaza esta decisión"

invariants:
  - id: INV-ADR-001
    name: numero_unico
    rule: UNIQUE(numero)
    description: "Número de ADR debe ser único"

  - id: INV-ADR-002
    name: accepted_immutable
    rule: estado = 'Accepted' → decision IS IMMUTABLE
    description: "ADR aceptado es inmutable"

  - id: INV-ADR-003
    name: superseded_has_replacement
    rule: estado = 'Superseded' → superseded_by IS NOT NULL
    description: "ADR reemplazado debe referenciar su reemplazo"

morphisms:
  autor: [ENT-BACK-FUNCIONARIO]
  reemplazado_por: [ENT-DEV-ADR]
  afecta_stories: [ENT-DEV-STORY]

audit:
  fields_tracked:
    - estado
  retention_years: 10
