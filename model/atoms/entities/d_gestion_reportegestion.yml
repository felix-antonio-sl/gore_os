# ==============================================================================
# GORE_OS Entity Atom: ReporteGestion (Reporte de Gestión)
# ==============================================================================
# Domain: D-GESTION (Control de Gestión y Operación)
# Subdomain: Sistema de Control de Gestión (SCG)
# Source: domain_d-gestion.md M1, dialogo_riguroso_d_gestion.md
# ==============================================================================

_metadata:
  version: "1.0.0"
  status: active
  created_at: "2025-12-22"
  created_by: "Arquitecto Categórico + AR Virtual"
  domain: D-GESTION
  subdomain: scg
  kb_source:
    - "domain_d-gestion.md M1: SCG"
    - "dialogo_riguroso_d_gestion.md"

entity:
  id: ENT-GESTION-REPORTE
  name: ReporteGestion
  name_es: Reporte de Gestión
  description: |
    Documento estructurado que consolida el estado de avance
    del POA, indicadores y H_gore para un período específico.

    Tipos de reporte:
    - Mensual: Avance operativo por división
    - Trimestral: Cierre parcial con análisis
    - Anual: Evaluación integral para Cuenta Pública

    Es el output principal del SCG hacia el Gobernador.

  purpose: |
    Generar reportes de gestión para:
    - Informar avance al Gobernador
    - Documentar cierres trimestrales
    - Alimentar Cuenta Pública
    - Trazabilidad histórica

  categorical_type: Object
  is_abstract: false
  category: Transactional

attributes:
  - name: id_reporte
    type: String
    key: true
    description: "Identificador único (ej: REP-2025-T1)"

  - name: tipo
    type: Enum[Mensual, Trimestral, Anual, Extraordinario]
    nullable: false
    description: Tipo de reporte

  - name: periodo
    type: String
    nullable: false
    description: "Período cubierto (ej: 2025-T1, 2025-03)"

  - name: año_fiscal
    type: Integer
    nullable: false
    description: Año fiscal

  - name: trimestre
    type: Integer
    nullable: true
    description: Trimestre (1-4) si aplica

  - name: mes
    type: Integer
    nullable: true
    description: Mes (1-12) si aplica

  # Contenido
  - name: resumen_ejecutivo
    type: Text
    nullable: true
    description: Síntesis para Gobernador

  - name: contenido
    type: JSON
    nullable: false
    description: |
      Estructura del reporte:
      {
        "poas": [{poa_id, avance_pct, metas_cumplidas}],
        "hgore": {valor, tendencia, alertas},
        "riesgos_criticos": [{id, estado}],
        "playbooks_ejecutados": [{id, resultado}],
        "mejoras": [{id, estado}]
      }

  # H_gore del período
  - name: hgore_promedio
    type: Decimal
    nullable: true
    description: H_gore promedio del período

  - name: hgore_tendencia
    type: Enum[Mejorando, Estable, Degradando]
    nullable: true
    description: Tendencia del período

  # Indicadores clave
  - name: poa_avance_global
    type: Decimal
    nullable: true
    description: Avance promedio de POAs

  - name: ejecucion_presupuestaria
    type: Decimal
    nullable: true
    description: "Porcentaje de ejecución presupuestaria"

  - name: convenios_vigentes
    type: Integer
    nullable: true
    description: Número de convenios vigentes

  # Generación
  - name: fecha_generacion
    type: Date
    nullable: false
    description: Fecha de generación

  - name: generado_por_id
    type: String
    fk: ENT-BACK-FUNCIONARIO
    nullable: true
    description: Quien generó el reporte

  - name: generacion_automatica
    type: Boolean
    default: false
    description: ¿Generado automáticamente?

  # Aprobación
  - name: aprobador_id
    type: String
    fk: ENT-BACK-FUNCIONARIO
    nullable: true
    description: Quien aprobó (AR o GR)

  - name: fecha_aprobacion
    type: Date
    nullable: true
    description: Fecha de aprobación

  - name: estado
    type: Enum[Borrador, EnRevision, Aprobado, Publicado]
    default: Borrador
    description: Estado del reporte

  # Distribución
  - name: destinatarios
    type: Array[String]
    nullable: true
    description: Roles o personas que reciben

  - name: url_documento
    type: String
    nullable: true
    description: URL del documento final (PDF)

invariants:
  - id: INV-REP-001
    name: publicado_requiere_aprobacion
    rule: estado = 'Publicado' → fecha_aprobacion IS NOT NULL
    description: Reporte publicado debe estar aprobado
    severity: error

  - id: INV-REP-002
    name: trimestral_requiere_hgore
    rule: tipo = 'Trimestral' → hgore_promedio IS NOT NULL
    description: Reporte trimestral debe incluir H_gore
    severity: warning

morphisms:
  consolida: [ENT-GESTION-POA, ENT-GESTION-PUNTAJE-HGORE]
  aprobado_por: [ENT-BACK-FUNCIONARIO]
  alimenta: [CuentaPublica]

audit:
  fields_tracked:
    - estado
    - fecha_aprobacion
  retention_years: 10
