# ==============================================================================
# GORE_OS Entity Atom: PuntajeTDE
# ==============================================================================
# Domain: D-EVOL (Evolución e Inteligencia)
# Subdomain: Puente TDE-ORKO (M11)
# Source: Framework ORKO E6_ArchitecturalState
# ==============================================================================

_metadata:
  version: "1.0.0"
  status: active
  created_at: "2025-12-22"
  created_by: "Arquitecto Categórico + Arquitecto ORKO"
  domain: D-EVOL
  subdomain: puente_tde_orko
  kb_source:
    - "urn:knowledge:orko:core:fundamentos:1.0.0"
    - "dialogo_triagente_d_evol.md"

entity:
  id: ENT-EVOL-PUNTAJE-TDE
  name: PuntajeTDE
  name_es: Puntaje de Cumplimiento TDE
  description: |
    Score consolidado de cumplimiento TDE para integración en H_org.
    Componente esencial del P4.Gobernanza en la fórmula de salud 
    organizacional.

    Fórmula: TDEScore = 0.25*DocDigital + 0.25*Ciberseguridad + 
                        0.30*Tramites + 0.20*Interoperabilidad

  purpose: |
    Modelar puntaje TDE para:
    - Snapshot periódico de cumplimiento
    - Integración en componente Gobernanza de H_org
    - Tracking de evolución de cumplimiento
    - Reporte a MINSEGPRES

  categorical_type: Metric
  is_abstract: false
  category: Assessment
  orko_entity: E6_ArchitecturalState

attributes:
  # Identificación
  - name: id_puntaje
    type: String
    key: true

  # Temporalidad
  - name: fecha
    type: Date
    nullable: false

  - name: periodo
    type: String
    nullable: true
    description: "Ej: 2025-Q1"

  # Componentes
  - name: puntaje_docdigital
    type: Decimal
    nullable: false
    description: "Score DocDigital (0..1)"

  - name: puntaje_ciberseguridad
    type: Decimal
    nullable: false
    description: "Score Ciberseguridad ANCI (0..1)"

  - name: puntaje_tramites
    type: Decimal
    nullable: false
    description: "Score Digitalización Trámites (0..1)"

  - name: puntaje_interoperabilidad
    type: Decimal
    nullable: false
    description: "Score PISEE/Interoperabilidad (0..1)"

  # Total
  - name: puntaje_total
    type: Decimal
    computed: true
    formula: 0.25*puntaje_docdigital + 0.25*puntaje_ciberseguridad + 0.30*puntaje_tramites + 0.20*puntaje_interoperabilidad

  # Integración H_org
  - name: integrado_en_h_org
    type: Boolean
    default: false
    description: "Si el puntaje fue consumido por cálculo H_org"

  - name: h_org_snapshot_id
    type: String
    nullable: true
    description: "Referencia al snapshot H_org que lo consumió"

  # Fuente
  - name: fuente
    type: Enum[Manual, API_MINSEGPRES, Automatico]
    default: Manual

invariants:
  - id: INV-TDE-001
    name: puntajes_normalizados
    rule: puntaje_docdigital BETWEEN 0 AND 1 AND puntaje_ciberseguridad BETWEEN 0 AND 1 AND puntaje_tramites BETWEEN 0 AND 1 AND puntaje_interoperabilidad BETWEEN 0 AND 1
    description: "Todos los componentes deben estar normalizados 0-1"

morphisms:
  alimenta: [ENT-EVOL-H_ORG]
  derivado_de: [ENT-EVOL-MAPEO-TDE]

audit:
  fields_tracked:
    - puntaje_total
    - integrado_en_h_org
  retention_years: 5
  legal_basis: "Ley 21.180, Reportes MINSEGPRES"
