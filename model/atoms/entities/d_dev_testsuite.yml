# ==============================================================================
# GORE_OS Entity Atom: TestSuite
# ==============================================================================
# Domain: D-DEV (Desarrollo del Sistema)
# Subdomain: CI/CD & QA (M4)
# ==============================================================================

_metadata:
  version: "1.0.0"
  status: active
  created_at: "2025-12-22"
  created_by: "Ingeniero Software Composicional"
  domain: D-DEV
  subdomain: cicd_qa

entity:
  id: ENT-DEV-TEST-SUITE
  name: TestSuite
  name_es: Suite de Tests
  description: |
    Colección de casos de prueba agrupados por funcionalidad o tipo.
    Reporta métricas de cobertura y resultados.

  purpose: |
    Modelar suites de tests para:
    - Quality gates en pipeline
    - Métricas de cobertura
    - Regresión automática

  categorical_type: Object
  is_abstract: false
  category: Quality

attributes:
  - name: id_suite
    type: String
    key: true

  - name: nombre
    type: String
    nullable: false

  - name: tipo
    type: Enum[Unit, Integration, E2E, Performance, Security]
    nullable: false

  - name: pipeline_id
    type: String
    fk: ENT-DEV-PIPELINE
    nullable: true

  - name: total_tests
    type: Integer
    nullable: false

  - name: tests_passed
    type: Integer
    nullable: false

  - name: tests_failed
    type: Integer
    nullable: false

  - name: tests_skipped
    type: Integer
    default: 0

  - name: cobertura_porcentaje
    type: Decimal
    nullable: true
    description: "Cobertura de código (0-100)"

  - name: duracion_ms
    type: Integer
    nullable: true

  - name: fecha_ejecucion
    type: DateTime
    nullable: false

  - name: resultado
    type: Enum[Passed, Failed, Partial]
    computed: true
    formula: |
      IF tests_failed = 0 THEN 'Passed'
      ELSE IF tests_passed > 0 THEN 'Partial'
      ELSE 'Failed'

invariants:
  - id: INV-TEST-001
    name: cobertura_minima
    rule: tipo = 'Unit' → cobertura_porcentaje >= 80
    description: "Tests unitarios requieren 80% cobertura mínima"

  - id: INV-TEST-002
    name: totales_consistentes
    rule: total_tests = tests_passed + tests_failed + tests_skipped
    description: "Los totales deben ser consistentes"

morphisms:
  ejecutado_en: [ENT-DEV-PIPELINE]
  contiene_casos: [ENT-DEV-TEST-CASE]

audit:
  fields_tracked:
    - resultado
    - cobertura_porcentaje
  retention_years: 2
