# Entidad: SeguimientoIPR
# Domain: D-FIN
# Subdomain: ipr_core
# Generated: 2025-12-21 (Phase 20.2 - CRM-IPR Deep Enrichment)

id: ENT-FIN-SEGUIMIENTO_IPR
urn: "urn:goreos:entity:d-fin:seguimiento-ipr:1.0.0"
name: Seguimiento de IPR
domain: D-FIN
subdomain: ipr_core
category: Transactional
canonical_source:
  - "agent_crm_ipr.yaml"
  - "kb_gn_019_gestion_ipr_koda.yml"
  - "CM-CRM-IPR-MINDSET"

description: |
  Registro de touchpoints CRM durante el ciclo de vida de una IPR.
  Captura llamadas, emails, reuniones, alertas y cambios de estado
  para trazabilidad completa de la gestión de inversión pública.

attributes:
  - name: id_seguimiento
    type: String
    key: true

  - name: ipr_id
    type: String
    fk: ENT-FIN-IPR
    nullable: false

  - name: convenio_id
    type: String
    fk: ENT-FIN-CONVENIO
    nullable: true
    description: Opcional, si el seguimiento es específico de un convenio

  # Evento
  - name: fecha_evento
    type: DateTime
    nullable: false

  - name: tipo_evento
    type: Enum[Llamada, Email, Reunion, VisitaTerreno, Alerta, CambioEstado, DocumentoRecibido, DocumentoEnviado, ObservacionEmitida, Escalamiento, Recordatorio]
    nullable: false

  - name: canal
    type: Enum[Telefono, Email, Presencial, VideoConferencia, SGDOC, BIP, SISREC]
    nullable: true

  # Actores
  - name: funcionario_gore_id
    type: String
    fk: ENT-GOB-FUNCIONARIO
    nullable: false
    description: Funcionario GORE que realiza el seguimiento

  - name: contacto_externo_nombre
    type: String
    nullable: true

  - name: contacto_externo_cargo
    type: String
    nullable: true

  - name: entidad_externa
    type: String
    nullable: true
    description: Municipalidad, ONG, Empresa, etc.

  # Contenido
  - name: descripcion
    type: Text
    nullable: false

  - name: fase_ipr
    type: Enum[Oportunidad, Formulacion, Ingreso, Evaluacion, Financiamiento, Formalizacion, Ejecucion, Modificacion, Cierre, Rendicion]
    nullable: true

  # Resultado
  - name: resultado
    type: Enum[Exitoso, SinRespuesta, Pendiente, Escalado, Informativo]
    default: Informativo

  - name: requiere_accion
    type: Boolean
    default: false

  - name: proxima_accion
    type: String
    nullable: true

  - name: fecha_proxima_accion
    type: Date
    nullable: true

  - name: responsable_proxima_accion
    type: String
    nullable: true

  # Documentación
  - name: documento_adjunto_url
    type: String
    nullable: true

  - name: numero_sgdoc
    type: String
    nullable: true

invariants:
  - name: funcionario_requerido
    rule: "funcionario_gore_id NOT NULL"

  - name: proxima_accion_coherente
    rule: "IF requiere_accion THEN proxima_accion NOT NULL"

morphisms:
  registra_sobre: [ENT-FIN-IPR, ENT-FIN-CONVENIO]
  realizado_por: [ENT-GOB-FUNCIONARIO]
  genera: [AlertaIPR]
