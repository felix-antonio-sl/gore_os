_meta:
  urn: urn:goreos:entity:d-ejec:evento-multa:1.0.0
  type: Entity
  schema: urn:goreos:schema:entity:1.0.0
id: ENT-EJEC-EVENTO_MULTA
urn: urn:goreos:entity:d-ejec:evento-multa:1.0.0
name: Evento de Multa
domain: D-EJEC
category: Transactional
is_abstract: false
attributes:
- name: id_multa
  type: String
  key: true
- name: convenio_id
  type: String
  fk: ENT-FIN-CONVENIO
  nullable: false
- name: numero_resolucion
  type: String
  nullable: true
  description: Número de acto administrativo que aplica la multa (si aplica)
- name: origen
  type: Enum[AtrasoHito, IncumplimientoInstruccion, AusenciaProfesional, SeguridadLaboral,
    CalidadDeficiente, Otro]
  nullable: false
- name: descripcion_incumplimiento
  type: Text
  nullable: false
- name: bitacora_entrada_id
  type: String
  fk: ENT-EJEC-BITACORA_OBRA
  nullable: true
  description: Referencia a la anotación en el Libro de Obras/Comunicaciones donde
    se constató la falta
- name: base_calculo
  type: Enum[MontoTotalContractual, ValorEstadoPago, UTM, UF, MontoFijo]
  nullable: false
- name: factor_multa
  type: Decimal
  nullable: false
  description: Valor numérico (porcentaje o cantidad)
- name: monto_estimado
  type: Decimal
  nullable: false
- name: fecha_notificacion
  type: Date
  nullable: false
- name: tiene_descargos
  type: Boolean
  default: false
- name: fecha_descargos
  type: Date
  nullable: true
- name: resultado_descargos
  type: Enum[Rechazados, AcogidosParcialmente, AcogidosTotalmente]
  nullable: true
- name: monto_final
  type: Decimal
  nullable: true
- name: estado
  type: Enum[Notificada, EnDescargo, ResueltaAplica, ResueltaAbsuelta, Ejecutoriada,
    Descontada, Anulada]
  default: Notificada
- name: estado_pago_descuento_id
  type: String
  fk: ENT-FIN-ESTADO_PAGO
  nullable: true
  description: EP donde se materializó el descuento
invariants:
- name: monto_final_requerido
  rule: IF estado = Ejecutoriada THEN monto_final NOT NULL
- name: descuento_vinculado
  rule: IF estado = Descontada THEN estado_pago_descuento_id NOT NULL
