# ==============================================================================
# GORE_OS Entity Atom: Delegacion
# ==============================================================================
# Domain: D-EVOL (Evolución e Inteligencia)
# Subdomain: Governance HAIC
# Source: ORKO I5_HAIC (M1-M6)
# ==============================================================================

_metadata:
  version: "1.0.0"
  status: active
  created_at: "2025-12-22"
  created_by: "Arquitecto Categórico + Arquitecto ORKO"
  domain: D-EVOL
  subdomain: governance_haic
  kb_source:
    - "urn:knowledge:orko:core:fundamentos:1.0.0"
    - "dialogo_triagente_d_evol.md"

entity:
  id: ENT-EVOL-DELEGACION
  name: Delegacion
  name_es: Delegación HAIC
  description: |
    Asignación de una capacidad algorítmica/IA a un funcionario humano bajo
    el framework de governance HAIC (Human-AI Collaboration).

    Invariante I5: "AI tiene autonomía acotada, accountability humana 
    intransferible."

    Niveles de Delegación:
    - M1: AI observa, humano decide
    - M2: AI sugiere, humano decide
    - M3: Humano invoca, AI ejecuta supervisada
    - M4: AI decide (reglas), humano handles exceptions
    - M5: Humano + AI colaboran par-a-par
    - M6: AI autónoma (bounded), humano supervisa/override

  purpose: |
    Modelar delegaciones HAIC para:
    - Trazabilidad de accountability
    - Progresión controlada de autonomía (M1→M6)
    - Override mechanism siempre disponible
    - Evidencia de desempeño para promoción/degradación

  categorical_type: Transaction
  is_abstract: false
  category: Governance
  orko_invariant: I5_HAIC

attributes:
  # Identificación
  - name: id_delegacion
    type: String
    key: true

  # Capacidad IA Delegada
  - name: capacidad_ia_id
    type: String
    fk: ENT-EVOL-CAPACIDAD
    nullable: false

  # Funcionario Accountable
  - name: funcionario_accountable_id
    type: String
    fk: ENT-BACK-FUNCIONARIO
    nullable: false
    description: "Humano con accountability moral intransferible"

  # Modo de Delegación
  - name: modo
    type: Enum[M1_Monitorear, M2_Asistir, M3_Habilitar, M4_Controlar, M5_Supervisar, M6_Ejecutar]
    nullable: false

  # Temporalidad
  - name: fecha_inicio
    type: Date
    nullable: false

  - name: fecha_fin
    type: Date
    nullable: true
    description: "NULL = delegación vigente"

  # Evidencia (Explainability M3+)
  - name: evidencia_url
    type: String
    nullable: true
    description: "URL a documentación de explainability"

  - name: trajectory_log_id
    type: String
    nullable: true
    description: "Referencia a log de desempeño"

  # Override
  - name: override_enabled
    type: Boolean
    default: true
    description: "Mecanismo de override disponible"

  # Guardrails
  - name: guardrails_comprehensive
    type: Boolean
    default: false
    description: "Guardrails completos (requerido para M6)"

  # Estado
  - name: estado
    type: Enum[Activa, Suspendida, Revocada, Completada]
    default: Activa

  # Promoción/Degradación
  - name: modo_anterior
    type: Enum[M1_Monitorear, M2_Asistir, M3_Habilitar, M4_Controlar, M5_Supervisar, M6_Ejecutar]
    nullable: true
    description: "Modo previo a promoción/degradación"

  - name: fecha_cambio_modo
    type: Date
    nullable: true

invariants:
  - id: INV-DEL-001
    name: explainability_m3_plus
    rule: modo ∈ {'M3_Habilitar', 'M4_Controlar', 'M5_Supervisar', 'M6_Ejecutar'} → evidencia_url IS NOT NULL
    description: "Explainability obligatoria para M3+"
    orko_ref: I5_HAIC

  - id: INV-DEL-002
    name: m6_requiere_override
    rule: modo = 'M6_Ejecutar' → override_enabled = true
    description: "M6 requiere override mechanism"
    orko_ref: I5_HAIC

  - id: INV-DEL-003
    name: m6_requiere_guardrails
    rule: modo = 'M6_Ejecutar' → guardrails_comprehensive = true
    description: "M6 requiere guardrails completos"
    orko_ref: I5_HAIC

  - id: INV-DEL-004
    name: capacidad_algoritmico
    rule: capacidad_ia_id.sustrato ∈ {'Algoritmico', 'Mixto'}
    description: "Solo capacidades algorítmicas pueden delegarse"

morphisms:
  asigna: [ENT-EVOL-CAPACIDAD]
  responsable: [ENT-BACK-FUNCIONARIO]
  tiene_registros: [ENT-EVOL-REGISTRO-DESEMPENO]

audit:
  fields_tracked:
    - modo
    - estado
    - fecha_cambio_modo
  retention_years: 10
  legal_basis: "Framework ORKO, Governance HAIC"
