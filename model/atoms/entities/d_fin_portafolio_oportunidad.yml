_meta:
  urn: urn:goreos:entity:unknown:unknown:1.0.0
  type: Entity
  schema: urn:goreos:schema:entity:1.0.0
category: Master
is_abstract: false
attributes:
- name: id_oportunidad
  type: String
  key: true
  description: Identificador único (ej. OPP-2025-0001)
- name: titulo
  type: String
  nullable: false
  description: Nombre descriptivo de la oportunidad
- name: descripcion
  type: Text
  nullable: true
  description: Detalle del problema u oportunidad detectada
- name: fecha_deteccion
  type: Date
  nullable: false
  description: Cuándo se identificó la oportunidad
- name: fuente_origen
  type: Enum[DemandaTerritorial, CompromisoGobernador, BrechaERD, PropuestaCiudadana,
    ContinuidadPrograma, Emergencia, ProactivoGORE, SolicitudServicio]
  nullable: false
  description: Cómo se originó la oportunidad
- name: referencia_origen
  type: String
  nullable: true
  description: Documento, reunión o evento de origen
- name: solicitante_nombre
  type: String
  nullable: true
  description: Persona o entidad que planteó la demanda
- name: solicitante_institucion
  type: String
  nullable: true
  description: Institución del solicitante
- name: comuna_id
  type: String
  fk: ENT-TERR-COMUNA
  nullable: true
  description: Comuna principal afectada
- name: comunas_adicionales
  type: Array[String]
  nullable: true
  description: Otras comunas si es intercomunal
- name: sector_erd
  type: String
  nullable: true
  description: Sector de la ERD relacionado
- name: eje_erd_id
  type: String
  fk: ENT-PLAN-EJE-ERD
  nullable: true
  description: Eje estratégico ERD
- name: tipo_intervencion_probable
  type: Enum[IDI, PPR, FRIL, SUBVENCION_8, CIRCULAR_33, FRPD, POR_DEFINIR]
  default: POR_DEFINIR
  description: Tipo de IPR más probable
- name: subtitulo_probable
  type: String
  nullable: true
  description: Subtítulo presupuestario estimado (31, 24, etc.)
- name: monto_estimado
  type: Decimal
  nullable: true
  description: Costo estimado preliminar
- name: beneficiarios_estimados
  type: Integer
  nullable: true
  description: Población beneficiaria estimada
- name: fase_embudo
  type: Enum[Detectada, EnAnalisis, Priorizada, EnFormulacion, Descartada, ConvertidaIPR]
  default: Detectada
  description: Estado en el pipeline de oportunidades
- name: fecha_cambio_fase
  type: Date
  nullable: true
  description: Última transición de fase
- name: puntaje_impacto
  type: Decimal
  nullable: true
  description: Score de impacto (1-10)
- name: puntaje_viabilidad
  type: Decimal
  nullable: true
  description: Score de viabilidad técnica/financiera (1-10)
- name: puntaje_urgencia
  type: Decimal
  nullable: true
  description: Score de urgencia (1-10)
- name: puntaje_alineacion_erd
  type: Decimal
  nullable: true
  description: Score de alineación estratégica (1-10)
- name: puntaje_total
  type: Decimal
  computed: true
  formula: (puntaje_impacto * 0.3) + (puntaje_viabilidad * 0.25) + (puntaje_urgencia
    * 0.2) + (puntaje_alineacion_erd * 0.25)
  description: Puntaje ponderado para ranking
- name: ipr_generada_id
  type: String
  fk: ENT-FIN-IPR
  nullable: true
  description: IPR si fue convertida
- name: motivo_descarte
  type: String
  nullable: true
  description: Razón si fue descartada
- name: analista_asignado_id
  type: String
  fk: ROL-FUNCIONARIO
  nullable: true
  description: Funcionario responsable del seguimiento
- name: division_responsable
  type: Enum[DIPLADE, DAE, DAF, DOST, OTRA]
  nullable: true
  description: División que lidera el análisis
- name: notas
  type: Text
  nullable: true
  description: Observaciones y seguimiento
- name: documentos_adjuntos
  type: Array[String]
  nullable: true
  description: URLs de documentos de respaldo
invariants:
- id: INV-OPP-001
  name: convertida_tiene_ipr
  rule: '(fase_embudo = ''ConvertidaIPR'') → ipr_generada_id IS NOT NULL

    '
  description: Si está convertida, debe tener IPR vinculada
  severity: error
- id: INV-OPP-002
  name: descartada_tiene_motivo
  rule: '(fase_embudo = ''Descartada'') → motivo_descarte IS NOT NULL

    '
  description: El descarte requiere justificación
  severity: warning
- id: INV-OPP-003
  name: priorizada_tiene_puntaje
  rule: '(fase_embudo = ''Priorizada'') → puntaje_total IS NOT NULL

    '
  description: La priorización requiere evaluación previa
- id: INV-OPP-004
  name: puntajes_en_rango
  rule: 'ALL puntaje_* BETWEEN 1.0 AND 10.0

    '
  description: Los puntajes deben estar en escala 1-10
