_meta:
  urn: urn:goreos:entity:d-fin:modif-presupuestaria:1.0.0
  type: Entity
  schema: urn:goreos:schema:entity:1.0.0
id: ENT-FIN-MODIF_PRESUPUESTARIA
urn: urn:goreos:entity:d-fin:modif-presupuestaria:1.0.0
name: Modificación Presupuestaria
domain: D-FIN
subdomain: presupuesto
category: Transactional
is_abstract: false
attributes:
- name: id_modificacion
  type: String
  key: true
- name: numero_solicitud
  type: String
  nullable: true
- name: fecha_solicitud
  type: Date
  nullable: false
- name: tipo_modificacion
  type: Enum[ReasignacionInterna, Suplemento, Reduccion, TransferenciaCapital, AporteFiscal]
  nullable: false
- name: nivel_aprobacion
  type: Enum[Nivel1_DAF, Nivel2_GORE_CORE, Nivel3_DIPRES]
  nullable: false
  description: Nivel jerárquico requerido para aprobar el cambio
- name: justificacion
  type: Text
  nullable: false
- name: monto_total_movimiento
  type: Decimal
  nullable: false
  description: Suma absoluta de movimientos (debe cuadrar)
- name: movimientos
  type: List[YAML]
  nullable: false
  description: Lista de {cuenta_origen, cuenta_destino, monto, programa_presupuestario}
- name: acto_administrativo_id
  type: String
  fk: ENT-FIN-ACTO_ADMINISTRATIVO
  nullable: true
  description: Resolución o Decreto que aprueba legalmente la modificación
- name: estado
  type: Enum[Borrador, Solicitada, EnRevision, AprobadaTecnicamente, EnTramiteLegal,
    Vigente, Rechazada]
  default: Borrador
- name: origen_solicitud
  type: Enum[IPR, Glosa02, Emergencia, AjusteCierre]
  nullable: true
- name: ipr_id
  type: String
  fk: ENT-FIN-IPR
  nullable: true
  description: Si la modificación es específica para un proyecto
invariants:
- name: cuadratura_movimientos
  rule: IF tipo_modificacion = ReasignacionInterna THEN sum(origen) = sum(destino)
- name: legalidad_requerida
  rule: IF estado = Vigente THEN acto_administrativo_id NOT NULL
