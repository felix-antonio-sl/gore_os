_meta:
  urn: urn:goreos:entity:d-fin:convenio:1.0.0
  type: Entity
  schema: urn:goreos:schema:entity:1.0.0
id: ENT-FIN-CONVENIO
urn: urn:goreos:entity:d-fin:convenio:1.0.0
name: Convenio de Transferencia
domain: D-FIN
subdomain: ipr_core
category: Transactional
is_abstract: false
attributes:
- name: id_convenio
  type: String
  key: true
- name: numero_resolucion
  type: String
  nullable: false
  description: Resolución GORE que aprueba el convenio
- name: fecha_resolucion
  type: Date
  nullable: false
- name: ipr_id
  type: String
  fk: ENT-FIN-IPR
  nullable: false
- name: tipo_convenio
  type: Enum[Transferencia, Mandato, MandatoMOP, Colaboracion, Comodato, Marco, EjecucionDirecta]
  nullable: false
  description: Incluye MandatoMOP para convenios con MOP (Phase 20.2 CRM-IPR)
- name: tipo_receptor
  type: Enum[PUBLICO, PRIVADO_SFL, ORG_COMUNITARIA, UNIVERSIDAD, MUNICIPALIDAD]
  nullable: true
  description: Naturaleza jurídica del receptor
- name: es_convenio_subvencion
  type: Boolean
  default: false
  description: Si es convenio de subvención (8%)
- name: porcentaje_honorarios_max
  type: Decimal
  nullable: true
  description: Límite máximo de honorarios sobre el total (ej. 30% en FRPD)
- name: requiere_cuenta_exclusiva
  type: Boolean
  default: false
  description: Si requiere cuenta bancaria exclusiva para el proyecto
- name: otorgante
  type: String
  default: GOBIERNO REGIONAL DE ÑUBLE
- name: ejecutor_id
  type: String
  fk: ENT-FIN-ACTOR_IPR
- name: ejecutor_nombre
  type: String
  nullable: false
- name: representante_ejecutor
  type: String
  nullable: true
- name: contraparte_gore_id
  type: String
  fk: ROL-FUNCIONARIO
  nullable: true
- name: monto_total
  type: Decimal
  nullable: false
- name: numero_cuotas
  type: Integer
  default: 1
- name: cronograma_pagos
  type: YAML
  nullable: true
  description: Lista de {cuota, monto, condicion, fecha_estimada}
- name: fecha_inicio
  type: Date
  nullable: false
- name: fecha_termino
  type: Date
  nullable: false
- name: plazo_meses
  type: Integer
  computed: true
- name: fecha_ultima_prorroga
  type: Date
  nullable: true
- name: cantidad_prorrogas
  type: Integer
  default: 0
- name: hitos
  type: YAML
  nullable: true
  description: Lista de {nombre, fecha, entregable, ponderacion}
- name: tdr_url
  type: String
  nullable: true
  description: Términos de Referencia adjuntos
- name: estado
  type: Enum[Borrador, EnFirma, Vigente, EnModificacion, Terminado, Resciliado]
  default: Borrador
- name: fecha_firma_gore
  type: Date
  nullable: true
- name: fecha_firma_ejecutor
  type: Date
  nullable: true
- name: convenio_original_id
  type: String
  fk: ENT-FIN-CONVENIO
  nullable: true
  description: Si es convenio modificatorio
- name: tipo_modificacion
  type: Enum[AumentoCosto, Prorroga, CambioAlcance, CambioEjecutor]
  nullable: true
- name: requiere_garantia
  type: Boolean
  default: false
- name: garantia_id
  type: String
  fk: ENT-FIN-GARANTIA
  nullable: true
- name: plazo_rendicion_dias
  type: Integer
  default: 60
  description: Días desde última cuota (Art. 35 Res. 30)
- name: porcentaje_rendido
  type: Decimal
  default: 0
- name: alerta_vencimiento_enviada
  type: Boolean
  default: false
- name: fecha_ultima_alerta
  type: Date
  nullable: true
- name: dias_para_vencimiento
  type: Integer
  computed: true
  description: Calculado desde fecha_termino - hoy
invariants:
- name: plazo_rendicion_legal
  rule: plazo_rendicion_dias <= 60
  source: Res. 30/2015 Art. 35
- name: prorroga_justificada
  rule: IF cantidad_prorrogas > 0 THEN fecha_ultima_prorroga NOT NULL
- name: modificacion_tope
  rule: IF tipo_modificacion = AumentoCosto THEN aumento <= 30% OR requiere_nuevo_proceso
  source: sub_dfin_ipr_core.md
