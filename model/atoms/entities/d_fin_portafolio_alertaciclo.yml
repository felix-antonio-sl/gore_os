_meta:
  urn: urn:goreos:entity:unknown:unknown:1.0.0
  type: Entity
  schema: urn:goreos:schema:entity:1.0.0
category: Master
is_abstract: false
attributes:
- name: id_alerta
  type: String
  key: true
  description: Identificador único de la alerta
- name: fecha_emision
  type: DateTime
  nullable: false
  description: Momento de generación de la alerta
- name: ipr_id
  type: String
  fk: ENT-FIN-IPR
  nullable: true
  description: IPR relacionada
- name: convenio_id
  type: String
  fk: ENT-FIN-CONVENIO
  nullable: true
  description: Convenio relacionado
- name: actor_id
  type: String
  fk: ENT-FIN-ACTOR_IPR
  nullable: true
  description: Ejecutor si la alerta es sobre rendiciones
- name: tipo_alerta
  type: Enum[VencimientoPlazo, RendicionPendiente, InactividadProlongada, RiesgoCaducidadBIP,
    AtrasoHito, ConvenioProximoVencer, GarantiaProximoVencer, ObservacionSinSubsanar,
    PresupuestoSinEjecutar, DesvioMayor]
  nullable: false
  description: Tipo de condición alertada
- name: severidad
  type: Enum[Informativa, Advertencia, Critica, Urgente]
  nullable: false
  description: Nivel de urgencia de la alerta
- name: fase_ciclo
  type: Enum[Formulacion, Evaluacion, Financiamiento, Ejecucion, Rendicion, Cierre]
  nullable: true
  description: Fase del ciclo de vida donde se detecta
- name: titulo
  type: String
  nullable: false
  description: Título descriptivo de la alerta
- name: descripcion
  type: Text
  nullable: true
  description: Detalle de la situación
- name: fecha_limite
  type: Date
  nullable: true
  description: Fecha límite del evento alertado
- name: dias_restantes
  type: Integer
  computed: true
  formula: fecha_limite - fecha_actual
  description: Días hasta el vencimiento
- name: dias_desde_deteccion
  type: Integer
  computed: true
  formula: fecha_actual - fecha_emision
  description: Días desde que se emitió la alerta
- name: origen
  type: Enum[Automatico, ManualFuncionario, SistemaBIP, IntegracionSIGFE]
  default: Automatico
  description: Cómo se generó la alerta
- name: regla_generadora
  type: String
  nullable: true
  description: ID de la regla de negocio que disparó la alerta
- name: destinatario_principal_id
  type: String
  fk: ROL-FUNCIONARIO
  nullable: true
  description: Funcionario principal responsable
- name: destinatarios_copia
  type: Array[String]
  nullable: true
  description: Otros funcionarios notificados
- name: escalar_a_id
  type: String
  fk: ROL-JEFATURA
  nullable: true
  description: Jefatura a escalar si no se atiende
- name: estado
  type: Enum[Activa, Reconocida, EnAtencion, Resuelta, Escalada, Vencida, Descartada]
  default: Activa
  description: Estado de gestión de la alerta
- name: fecha_reconocimiento
  type: DateTime
  nullable: true
  description: Cuándo alguien tomó conocimiento
- name: fecha_resolucion
  type: DateTime
  nullable: true
  description: Cuándo se resolvió la situación
- name: resolucion_comentario
  type: String
  nullable: true
  description: Cómo se resolvió
- name: dias_para_escalar
  type: Integer
  default: 3
  description: Días sin atender antes de escalar
- name: fue_escalada
  type: Boolean
  default: false
  description: Si la alerta fue escalada
- name: fecha_escalamiento
  type: DateTime
  nullable: true
  description: Cuándo se escaló
invariants:
- id: INV-ALE-001
  name: tiene_objeto_alertado
  rule: 'ipr_id IS NOT NULL OR convenio_id IS NOT NULL OR actor_id IS NOT NULL

    '
  description: La alerta debe referirse a algún objeto
  severity: error
- id: INV-ALE-002
  name: resuelta_tiene_comentario
  rule: '(estado = ''Resuelta'') → resolucion_comentario IS NOT NULL

    '
  description: La resolución requiere documentación
  severity: warning
- id: INV-ALE-003
  name: escalar_automaticamente
  rule: '(estado = ''Activa'' AND dias_desde_deteccion > dias_para_escalar) →

    estado = ''Escalada'' AND fue_escalada = true

    '
  description: Escalar si no se atiende en plazo
- id: INV-ALE-004
  name: critica_requiere_escalamiento
  rule: '(severidad = ''Critica'' OR severidad = ''Urgente'') →

    escalar_a_id IS NOT NULL

    '
  description: Alertas críticas deben tener definido escalamiento
