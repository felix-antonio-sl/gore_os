# ==============================================================================
# GORE_OS Entity Atom: DocumentoExpediente
# ==============================================================================
# Domain: D-NORM (Gestión Jurídico-Administrativa)
# Subdomain: Expediente Electrónico
# Source: DS10, Ley 21.180 TDE
# ==============================================================================

_metadata:
  version: "1.0.0"
  status: active
  created_at: "2025-12-21"
  created_by: "Arquitecto Categórico + Fiscal Virtual"
  domain: D-NORM
  subdomain: expediente_electronico
  kb_source:
    - "DS10: Reglamento Expediente Electrónico"
    - "Ley 21.180 TDE"

entity:
  id: ENT-NORM-DOCUMENTO
  name: DocumentoExpediente
  name_es: Documento del Expediente
  description: |
    Documento individual contenido en un expediente electrónico.
    Cada documento tiene un folio correlativo y trazabilidad completa.

  purpose: |
    - Registrar documentos del expediente
    - Mantener foliación correlativa
    - Trazabilidad de origen y fecha
    - Base para índice electrónico

  categorical_type: Object
  is_abstract: false
  category: Transactional

attributes:
  - name: id_documento
    type: String
    key: true
    description: Identificador único

  - name: expediente_id
    type: String
    fk: ENT-NORM-EXPEDIENTE
    nullable: false
    description: Expediente contenedor

  - name: folio
    type: Integer
    nullable: false
    description: Número de folio (correlativo)

  - name: tipo_documento
    type: Enum[Solicitud, Informe, Resolucion, Oficio, Anexo, Certificado, Notificacion, Otro]
    nullable: false
    description: Tipo de documento

  - name: nombre
    type: String
    nullable: false
    description: Nombre descriptivo

  - name: fecha_ingreso
    type: DateTime
    nullable: false
    description: Fecha y hora de incorporación

  - name: origen
    type: Enum[Interno, Externo, Ciudadano, Interoperable]
    nullable: false
    description: Origen del documento

  - name: remitente
    type: String
    nullable: true
    description: Remitente si es externo

  # Archivo
  - name: archivo_url
    type: String
    nullable: true
    description: URL al archivo

  - name: formato
    type: Enum[PDF, XML, JPG, PNG, DOCX, XLSX, Otro]
    default: PDF
    description: Formato del archivo

  - name: tamano_bytes
    type: Integer
    nullable: true
    description: Tamaño en bytes

  # Firma
  - name: firmado
    type: Boolean
    default: false
    description: ¿Documento firmado electrónicamente?

  - name: firma_id
    type: String
    fk: ENT-NORM-FIRMA
    nullable: true
    description: Firma asociada

invariants:
  - id: INV-DOC-001
    name: folio_unico_expediente
    rule: UNIQUE(expediente_id, folio)
    description: Folio único dentro del expediente
    severity: error

morphisms:
  contenido_en: [ENT-NORM-EXPEDIENTE]
  firmado_por: [ENT-NORM-FIRMA]

audit:
  fields_tracked:
    - folio
    - firmado
  retention_years: 20
