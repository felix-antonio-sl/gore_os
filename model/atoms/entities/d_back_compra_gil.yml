_meta:
  urn: urn:goreos:entity:unknown:unknown:1.0.0
  type: Entity
  schema: urn:goreos:schema:entity:1.0.0
category: Master
is_abstract: false
attributes:
- name: id_compra_agil
  type: String
  key: true
  description: Identificador interno
- name: numero_solicitud
  type: String
  nullable: false
  description: Número de requerimiento interno
- name: fecha_solicitud
  type: Date
  nullable: false
  description: Fecha de la solicitud
- name: unidad_solicitante
  type: String
  nullable: false
  description: División o departamento que requiere
- name: solicitante_id
  type: String
  fk: ROL-FUNCIONARIO
  nullable: false
  description: Funcionario que solicita
- name: descripcion
  type: Text
  nullable: false
  description: Detalle de bienes/servicios requeridos
- name: rubro
  type: Enum[Bien, Servicio, BienServicio]
  nullable: false
  description: Tipo de adquisición
- name: categoria_onu
  type: String
  nullable: true
  description: Código de producto/servicio ONU
- name: monto_estimado
  type: Decimal
  nullable: false
  description: Monto estimado en CLP
- name: monto_utm
  type: Decimal
  computed: true
  formula: monto_estimado / valor_utm
  description: Equivalente en UTM
- name: monto_adjudicado
  type: Decimal
  nullable: true
  description: Monto final de la OC
- name: modalidad
  type: Enum[ConvenioMarco, TratoDirectoConCotizaciones, TratoDirectoUnicoProveedor,
    CompraMenor10UTM]
  nullable: false
  description: Tipo de procedimiento utilizado
- name: justificacion_modalidad
  type: Text
  nullable: true
  description: Razón si es trato directo único proveedor
- name: cantidad_cotizaciones
  type: Integer
  default: 0
  description: Número de cotizaciones obtenidas
- name: cotizaciones
  type: YAML
  nullable: true
  description: Lista de {proveedor_rut, proveedor_nombre, monto, fecha}
- name: cuadro_comparativo_url
  type: String
  nullable: true
  description: URL del cuadro comparativo
- name: proveedor_rut
  type: String
  nullable: true
  description: RUT del proveedor adjudicado
- name: proveedor_nombre
  type: String
  nullable: true
  description: Razón social
- name: criterio_seleccion
  type: Enum[MenorPrecio, MejorRelacionCalidadPrecio, UnicoOferente, ConvenioMarco]
  nullable: true
  description: Criterio de adjudicación
- name: cdp_id
  type: String
  fk: ENT-FIN-CDP
  nullable: false
  description: Certificado de disponibilidad
- name: imputacion
  type: String
  nullable: false
  description: Código presupuestario
- name: id_mercado_publico
  type: String
  nullable: true
  description: ID de la OC en ChileCompra
- name: fecha_publicacion_oc
  type: Date
  nullable: true
  description: Fecha de emisión de la OC
- name: estado
  type: Enum[Solicitada, EnCotizacion, Adjudicada, OCEmitida, Recibida, Pagada, Anulada]
  default: Solicitada
  description: Estado del proceso
- name: aprobador_id
  type: String
  fk: ROL-JEFE-ABASTECIMIENTO
  nullable: true
  description: Jefatura que aprueba
- name: fecha_aprobacion
  type: Date
  nullable: true
  description: Fecha de aprobación
invariants:
- id: INV-CAG-001
  name: monto_hasta_100_utm
  rule: monto_utm <= 100
  description: Compra ágil solo hasta 100 UTM
  source: Ley 19.886 Art. 7
  severity: error
- id: INV-CAG-002
  name: cotizaciones_minimas
  rule: '(modalidad = ''TratoDirectoConCotizaciones'') → cantidad_cotizaciones >=
    3

    '
  description: Trato directo requiere mínimo 3 cotizaciones
  source: Reglamento DS 250
  severity: error
- id: INV-CAG-003
  name: unico_proveedor_justificado
  rule: "(modalidad = 'TratoDirectoUnicoProveedor') → \njustificacion_modalidad IS\
    \ NOT NULL\n"
  description: Único proveedor requiere justificación
  severity: error
