_meta:
  urn: urn:goreos:entity:d_ops:ENT-OPS-DESPLIEGUE:1.0.0
  type: Entity
  schema: urn:goreos:schema:entity:1.0.0
category: Master
is_abstract: false
attributes:
- name: id_despliegue
  type: String
  key: true
  description: UUID
- name: release_id
  type: String
  fk: ENT-DEV-RELEASE
  nullable: false
- name: ambiente_id
  type: String
  fk: ENT-OPS-AMBIENTE
  nullable: false
- name: desplegado_por_id
  type: String
  fk: ENT-BACK-FUNCIONARIO
  nullable: false
- name: fecha_inicio
  type: Timestamp
  nullable: false
- name: fecha_fin
  type: Timestamp
  nullable: true
- name: duracion_segundos
  type: Integer
  computed: true
  formula: fecha_fin - fecha_inicio
- name: estado
  type: Enum[EnProgreso, Exitoso, Fallido, Cancelado, Rollback]
  default: EnProgreso
- name: logs_url
  type: String
  nullable: true
  description: Link a logs del pipeline
- name: aprobado_por_id
  type: String
  fk: ENT-BACK-FUNCIONARIO
  nullable: true
  description: Quien autorizó (si el ambiente es protegido)
invariants:
- id: INV-DEPLOY-001
  name: ambiente_protegido_requiere_aprobacion
  rule: "(SELECT es_protegido FROM Ambiente WHERE id_ambiente = ambiente_id) = TRUE\
    \ \n→ aprobado_por_id IS NOT NULL\n"
  description: Despliegue en ambiente protegido requiere aprobación
id: ENT-OPS-DESPLIEGUE
urn: urn:goreos:entity:d_ops:ENT-OPS-DESPLIEGUE:1.0.0
name: Despliegue
domain: D-OPS
