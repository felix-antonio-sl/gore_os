_meta:
  urn: urn:goreos:entity:unknown:unknown:1.0.0
  type: Entity
  schema: urn:goreos:schema:entity:1.0.0
category: Master
is_abstract: false
attributes:
- name: id_puntaje
  type: String
  key: true
  description: Identificador único
- name: fecha
  type: Date
  nullable: false
  description: Fecha del cálculo
- name: hora_calculo
  type: Time
  nullable: true
  description: Hora del cálculo
- name: valor_compuesto
  type: Decimal
  nullable: false
  description: H_gore calculado (0-100)
- name: valor_anterior
  type: Decimal
  nullable: true
  description: H_gore del período anterior
- name: variacion
  type: Decimal
  computed: true
  formula: valor_compuesto - valor_anterior
  description: Cambio respecto a período anterior
- name: puntajes_dimension
  type: JSON
  nullable: false
  description: 'Map {dimension_id: puntaje}'
- name: dimensiones_criticas
  type: Array[String]
  computed: true
  description: IDs de dimensiones bajo umbral
- name: estado_semaforo
  type: Enum[Verde, Amarillo, Rojo]
  computed: true
  formula: "CASE \n  WHEN valor_compuesto >= 80 THEN 'Verde'\n  WHEN valor_compuesto\
    \ >= 60 THEN 'Amarillo'\n  ELSE 'Rojo'\nEND\n"
  description: Estado visual
- name: tendencia
  type: Enum[Mejorando, Estable, Degradando]
  nullable: true
  description: Tendencia últimos 7 días
- name: alerta_generada
  type: Boolean
  default: false
  description: ¿Se generó alerta?
- name: tipo_alerta
  type: Enum[Ninguna, NotificacionDireccion, ActivacionFENIX]
  default: Ninguna
  description: Tipo de alerta si aplica
- name: playbook_activado_id
  type: String
  fk: ENT-GESTION-EJECUCION-PLAYBOOK
  nullable: true
  description: Playbook activado por esta alerta
- name: observaciones
  type: Text
  nullable: true
  description: Notas sobre el período
- name: eventos_relevantes
  type: Array[String]
  nullable: true
  description: Eventos que afectaron el puntaje
invariants:
- id: INV-HGORE-001
  name: rango_valido
  rule: valor_compuesto >= 0 AND valor_compuesto <= 100
  description: Puntaje debe estar entre 0 y 100
  severity: error
- id: INV-HGORE-002
  name: alerta_rojo_sostenido
  rule: "(SELECT COUNT(*) FROM PuntajeSaludGore p2 \n WHERE p2.fecha >= CURRENT_DATE\
    \ - 14 \n AND p2.estado_semaforo = 'Rojo') >= 2*7\n→ alerta_generada = TRUE AND\
    \ tipo_alerta IN ('NotificacionDireccion', 'ActivacionFENIX')\n"
  description: 2 semanas en rojo activa alerta
  severity: error
- id: INV-HGORE-003
  name: critico_activa_fenix
  rule: valor_compuesto < 50 → tipo_alerta = 'ActivacionFENIX'
  description: Puntaje crítico activa FÉNIX
