---
_meta:
  urn: urn:goreos:entity:actio:convenio:1.0.0
  type: Entity
  schema: urn:goreos:schema:entity:1.0.0
id: ENT-EJE-CONVENIO
name: Convenio (Ejecución)
domain: D-EJE
category: Master
description: |
  Instancia de ejecución de un Convenio de Programación.
  Fibra D-EJE sobre D-FIN: representa el convenio cuando entra en fase activa
  de ejecución, con seguimiento de avances, pagos, hitos y garantías.
  Esta entidad es el punto focal de todas las operaciones de ejecución.
attributes:
  - { name: id_convenio_eje, type: UUID, key: true }
  - {
      name: cp_origen_id,
      type: UUID,
      fk: ENT-FIN-CONVENIO_PROGRAMACION,
      description: "Convenio de Programación fuente",
    }
  - {
      name: ipr_id,
      type: UUID,
      fk: ENT-FIN-IPR,
      nullable: true,
      description: "IPR asociada si aplica",
    }
  - { name: codigo_interno, type: String }
  - { name: fecha_inicio_real, type: Date }
  - { name: fecha_termino_prevista, type: Date }
  - { name: fecha_termino_real, type: Date, nullable: true }
  - { name: ejecutor_id, type: UUID, fk: ENT-EJE-EJECUTOR, nullable: true }
  - {
      name: unidad_tecnica_id,
      type: UUID,
      fk: ENT-ORG-DIVISION,
      nullable: true,
    }
  - { name: monto_convenido, type: Decimal }
  - { name: monto_ejecutado, type: Decimal, default: 0 }
  - { name: porcentaje_avance_fisico, type: Integer, default: 0 }
  - { name: porcentaje_avance_financiero, type: Integer, default: 0 }
  - {
      name: estado,
      type: String,
      description: "EN_TRAMITE|VIGENTE|SUSPENDIDO|TERMINADO|LIQUIDADO|RESCILIADO",
    }
  - { name: tiene_problemas_abiertos, type: Boolean, default: false }
  - {
      name: nivel_alerta,
      type: String,
      nullable: true,
      description: "NORMAL|ATENCION|ALTO|CRITICO",
    }

# Invariantes Categoriales
invariants:
  - id: CONV-EJE-ORIGEN-REQUERIDO
    description: "Todo convenio en ejecución debe tener un CP de origen"
    expression: "∀ conv: cp_origen_id IS NOT NULL"

  - id: CONV-EJE-MONTOS-COHERENTES
    description: "Monto ejecutado no puede superar el convenido"
    expression: "∀ conv: monto_ejecutado ≤ monto_convenido"
