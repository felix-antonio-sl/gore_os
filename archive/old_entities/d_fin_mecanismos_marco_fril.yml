_meta:
  urn: urn:goreos:entity:d_fin:ENT-FIN-MECANISMOS_MARCO_FRIL:1.0.0
  type: Entity
  schema: urn:goreos:schema:entity:1.0.0
category: Master
is_abstract: false
attributes:
- name: id_marco
  type: String
  key: true
  description: Identificador único (ej. MARCO-FRIL-2025-CHILLAN)
- name: anio_presupuestario
  type: Integer
  nullable: false
  description: Año del marco presupuestario
- name: comuna_id
  type: String
  fk: ENT-TERR-COMUNA
  nullable: false
  description: "Código de la comuna (21 comunas de Ñuble):\nChillán, Chillán Viejo,\
    \ San Carlos, Los Ángeles, Bulnes, Coihueco, \nCoelemu, El Carmen, Ninhue, Ñiquén,\
    \ Pemuco, Pinto, Portezuelo, \nQuillón, Quirihue, Ránquil, San Fabián, San Ignacio,\
    \ San Nicolás, \nTrehuaco, Yungay\n"
- name: fondo_id
  type: String
  fk: ENT-FIN-FONDO
  default: FRIL
  description: Referencia al fondo FRIL
- name: monto_maximo_regular
  type: Decimal
  default: 1000000000
  description: Monto máximo a postular en período regular (CLP)
- name: max_iniciativas_regular
  type: Integer
  default: 5
  description: Máximo de iniciativas en período regular
- name: monto_minimo_por_proyecto
  type: Decimal
  default: 100000000
  description: Monto mínimo por proyecto FRIL
- name: monto_maximo_por_proyecto
  type: Decimal
  default: 306464805
  description: "Monto máximo por proyecto (4.545 UTM).\nSe descuenta 10% del máximo\
    \ normativo de 5.000 UTM para \ncubrir posibles aumentos de obra.\n"
- name: monto_postulado
  type: Decimal
  default: 0
  description: Suma de montos de iniciativas postuladas (sin excepción)
- name: monto_adjudicado
  type: Decimal
  default: 0
  description: Suma de montos de iniciativas adjudicadas
- name: iniciativas_postuladas
  type: Integer
  default: 0
  description: Cantidad de iniciativas postuladas (sin excepción)
- name: iniciativas_adjudicadas
  type: Integer
  default: 0
  description: Cantidad de iniciativas adjudicadas
- name: categorias_exceptuadas
  type: Array[Enum]
  default: '[A2_ACCESO_AGUA, A3_VIAL]'
  description: 'Categorías que no cuentan para el límite de 5 iniciativas:

    - A2: Acceso al Agua (sistemas APR, alcantarillado, etc.)

    - A3: Vial (aceras, baches, caminos, veredas, etc.)

    '
- name: iniciativas_exceptuadas_postuladas
  type: Integer
  default: 0
  description: Iniciativas en categorías exceptuadas
- name: monto_exceptuado_postulado
  type: Decimal
  default: 0
  description: Monto de iniciativas exceptuadas
- name: tiene_llamado_extraordinario
  type: Boolean
  default: false
  description: Si hay llamado extraordinario para esta comuna
- name: monto_extraordinario_disponible
  type: Decimal
  nullable: true
  description: Monto adicional de llamado extraordinario
- name: iniciativas_extraordinarias_permitidas
  type: Integer
  nullable: true
  description: Cupos adicionales del llamado extraordinario
- name: resolucion_extraordinario_id
  type: String
  nullable: true
  description: Resolución que aprueba el llamado extraordinario
- name: estado
  type: Enum[Activo, Cerrado, EnLlamadoExtraordinario]
  default: Activo
  description: Estado del marco presupuestario
- name: fecha_cierre_1er_llamado
  type: Date
  nullable: true
  description: Fecha límite del primer llamado
- name: fecha_cierre_2do_llamado
  type: Date
  nullable: true
  description: Fecha límite del segundo llamado (Sep 1-30)
- name: observaciones
  type: String
  nullable: true
  description: Notas sobre el marco comunal
invariants:
- id: INV-MARCO-FRIL-001
  name: limite_iniciativas_regular
  rule: 'iniciativas_postuladas <= max_iniciativas_regular

    '
  description: No puede exceder el límite de iniciativas regulares
  exception: Categorías A2 y A3 no cuentan para este límite
  source: kb_gn_026 Sec. 3
- id: INV-MARCO-FRIL-002
  name: limite_monto_regular
  rule: 'monto_postulado <= monto_maximo_regular

    '
  description: El monto postulado no puede exceder el marco
  source: kb_gn_026 Sec. 3
- id: INV-MARCO-FRIL-003
  name: proyecto_dentro_rango
  rule: "FOR_ALL ipr IN iniciativas_postuladas:\n  ipr.monto >= monto_minimo_por_proyecto\
    \ AND\n  ipr.monto <= monto_maximo_por_proyecto\n"
  description: Cada proyecto debe estar entre $100M y ~$306M
  source: kb_gn_026 Sec. 3
- id: INV-MARCO-FRIL-004
  name: extraordinario_requiere_resolucion
  rule: "(tiene_llamado_extraordinario = true) → \nresolucion_extraordinario_id IS\
    \ NOT NULL\n"
  description: Llamado extraordinario requiere resolución exenta
  source: kb_gn_026 Sec. 3
- id: INV-MARCO-FRIL-005
  name: 21_comunas_nuble
  rule: "comuna_id IN [\n  'CHILLAN', 'CHILLAN_VIEJO', 'SAN_CARLOS', 'BULNES', \n\
    \  'COIHUECO', 'COELEMU', 'EL_CARMEN', 'NINHUE', 'NIQUEN',\n  'PEMUCO', 'PINTO',\
    \ 'PORTEZUELO', 'QUILLON', 'QUIRIHUE',\n  'RANQUIL', 'SAN_FABIAN', 'SAN_IGNACIO',\
    \ 'SAN_NICOLAS',\n  'TREHUACO', 'YUNGAY', 'COBQUECURA'\n]\n"
  description: Solo comunas de la Región de Ñuble
  severity: error
- id: INV-MARCO-FRIL-006
  name: monto_maximo_4545_utm
  rule: 'monto_maximo_por_proyecto <= 5000 * valor_utm * 0.909

    '
  description: "Tope del 90% del máximo normativo (5.000 UTM) para \ncubrir posibles\
    \ aumentos de obra\n"
  source: kb_gn_026 Sec. 3
- id: INV-MARCO-FRIL-007
  name: adjudicado_no_excede_postulado
  rule: 'monto_adjudicado <= monto_postulado + monto_exceptuado_postulado

    '
  description: No se puede adjudicar más de lo postulado
id: ENT-FIN-MECANISMOS_MARCO_FRIL
urn: urn:goreos:entity:d_fin:ENT-FIN-MECANISMOS_MARCO_FRIL:1.0.0
name: Mecanismos Marco Fril
domain: D-FIN
