_meta:
  urn: urn:goreos:entity:d_tde:ENT-TDE-ACCIONEXPEDIENTE:1.0.0
  type: Entity
  schema: urn:goreos:schema:entity:1.0.0
category: Master
is_abstract: false
attributes:
- name: id_accion
  type: String
  key: true
  description: Identificador único
- name: expediente_id
  type: String
  fk: ENT-TDE-EXPEDIENTE
  nullable: false
  description: Expediente afectado
- name: tipo_accion
  type: Enum[Crear, AgregarDocumento, Derivar, Firmar, Suspender, Reanudar, Cerrar,
    Archivar, Consultar, Modificar, Anular]
  nullable: false
  description: Tipo de acción realizada
- name: descripcion
  type: Text
  nullable: true
  description: Descripción de la acción
- name: timestamp
  type: DateTime
  nullable: false
  description: Fecha y hora exacta de la acción
- name: funcionario_id
  type: String
  fk: ENT-BACK-FUNCIONARIO
  nullable: false
  description: Funcionario que ejecutó la acción
- name: rol_funcionario
  type: String
  nullable: true
  description: Rol del funcionario al momento
- name: ip_origen
  type: String
  nullable: true
  description: IP desde donde se ejecutó
- name: user_agent
  type: String
  nullable: true
  description: Navegador/aplicación utilizada
- name: documento_id
  type: String
  fk: ENT-TDE-DOCUMENTO
  nullable: true
  description: Documento afectado (si aplica)
- name: custodia_anterior_id
  type: String
  fk: ENT-BACK-FUNCIONARIO
  nullable: true
  description: Custodio anterior (para derivación)
- name: custodia_nueva_id
  type: String
  fk: ENT-BACK-FUNCIONARIO
  nullable: true
  description: Nuevo custodio (para derivación)
- name: estado_anterior
  type: String
  nullable: true
  description: Estado antes de la acción
- name: estado_nuevo
  type: String
  nullable: true
  description: Estado después de la acción
- name: exitosa
  type: Boolean
  default: true
  description: ¿La acción fue exitosa?
- name: error_mensaje
  type: String
  nullable: true
  description: Mensaje de error si falló
invariants:
- id: INV-ACC-001
  name: timestamp_obligatorio
  rule: timestamp IS NOT NULL
  description: Toda acción debe tener timestamp
  severity: error
- id: INV-ACC-002
  name: derivar_requiere_custodias
  rule: tipo_accion = 'Derivar' → custodia_anterior_id IS NOT NULL AND custodia_nueva_id
    IS NOT NULL
  description: Derivación debe registrar custodias
id: ENT-TDE-ACCIONEXPEDIENTE
urn: urn:goreos:entity:d_tde:ENT-TDE-ACCIONEXPEDIENTE:1.0.0
name: Accionexpediente
domain: D-TDE
